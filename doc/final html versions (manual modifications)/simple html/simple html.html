<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Kopi Application Generator : User guide</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /></head><body><div xml:lang="en" class="book" title="Kopi Application Generator : User guide" lang="en"><div class="logo">srd</div><div class="titlepage"><div><div><h1 class="title title_entete"><a id="id400520"></a>Kopi Application Generator :  User guide</h1></div></div><hr /></div>

	<div class="entete_header">
		<div class="logo_header">srd</div>
		<div class="title_header">Kopi Application Generator : User guide</div>
  </div>


<div class="toc title_mere"><p><strong>Table of Contents</strong></p><dl><dt><span class="preface"><a href="#_preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#_organization_of_this_document">1. Organization of This Document</a></span></dt></dl></dd><dt><span class="chapter" ><a href="#_xkjc_the_extended_kopi_java_language">1. XKJC - The Extended Kopi Java language</a></span></dt><dd><dl><dt><span class="section"><a href="#_xkjc_the_new_types">1.1. XKJC : The new Types</a></span></dt><dt><span class="section"><a href="#_xkjc_java_with_embedded_sql">1.2. XKJC : Java with embedded SQL</a></span></dt><dd><dl><dt><span class="section"><a href="#_connections">1.2.1. Connections</a></span></dt><dt><span class="section"><a href="#_cursors">1.2.2. Cursors</a></span></dt><dt><span class="section"><a href="#_sql_select_into_statement">1.2.3. SQL SELECT INTO Statement</a></span></dt><dt><span class="section"><a href="#_sql_expressions">1.2.4. SQL Expressions</a></span></dt><dt><span class="section"><a href="#_transactions">1.2.5. Transactions</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_vlib_the_visual_kopi_application_framework">2. VLIB - The Visual Kopi application framework</a></span></dt><dd><dl><dt><span class="section"><a href="#_generalities">2.1. Generalities</a></span></dt><dd><dl><dt><span class="section"><a href="#_syntax_terms">2.1.1. Syntax terms</a></span></dt><dt><span class="section"><a href="#_predefined_field_types">2.1.2. Predefined Field Types</a></span></dt><dt><span class="section"><a href="#_code_field_types">2.1.3. Code Field Types</a></span></dt><dt><span class="section"><a href="#_the_list_command">2.1.4. The LIST command</a></span></dt></dl></dd><dt><span class="section"><a href="#_visual_kopi_forms">2.2. Visual Kopi Forms</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_form_fields">2.2.1. Creating Form Fields</a></span></dt><dt><span class="section"><a href="#_creating_form_blocks">2.2.2. Creating Form Blocks</a></span></dt><dt><span class="section"><a href="#_creating_forms">2.2.3. Creating Forms</a></span></dt><dt><span class="section"><a href="#_form_context_footer">2.2.4. Form Context Footer</a></span></dt></dl></dd><dt><span class="section"><a href="#_visual_kopi_reports">2.3. Visual Kopi Reports</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_report_fields">2.3.1. Creating Report Fields</a></span></dt><dt><span class="section"><a href="#_creating_reports">2.3.2. Creating Reports</a></span></dt><dt><span class="section"><a href="#_calling_reports">2.3.3. Calling reports</a></span></dt></dl></dd><dt><span class="section"><a href="#_visual_kopi_print_pages">2.4. Visual Kopi Print Pages</a></span></dt><dd><dl><dt><span class="section"><a href="#_print_page_structure">2.4.1. Print Page Structure</a></span></dt><dt><span class="section"><a href="#_calling_print_pages">2.4.2. Calling Print Pages</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_the_kopi_project_future">3. The Kopi Project Future</a></span></dt></dl> <div class="entete_header2">
	 
	
	</div></div><div class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a id="_preface"></a>Preface</h2></div></div></div><p>The Kopi Project is a Java software project from DMS which provides a framework for developing database applications using Java, JDBC and SWING.</p><p>Kopi contains a set of tools which allow you to edit and generate classfiles: dis (Java disassembler), KSM (Java assembler) and KJC. KJC compiles Java source code to bytecode, with all the same plus even more features as commercial compilers. KJC is available for free under the terms of the GNU Public License.</p><p>The Kopi Project also includes XKJC, a compiler for embedded SQL in Java. Built over JDBC, it allows the execution of Java-typed SQL statements and the mixing of expressions from both SQL and Java.</p><p>The last tool provided by DMS is Visual Kopi. Visual Kopi is an application framework using JDBC and JFC/Swing which lets you create database applications in a high level specification language. It also provides the ability to write triggers and commands in Java with seamlessly embedded SQL statements.</p><div class="section" title="1. Organization of This Document"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_organization_of_this_document"></a>1. Organization of This Document</h2></div></div></div><p>This documentation includes two main Chapters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
CHAPTER 1 : XKJC - The EXtended Kopi Java language+
XKJC is a compiler for embedded SQL in Java. This language is a super set of Java; i.e., it is compatible with Java source code. This allows the execution of Java-typed SQL statements and the mixing of expressions from both SQL and Java.
</li><li class="listitem">
CHAPTER 2 : VLIB - The Visual Kopi application Framework+
Visual Kopi is an application framework using SWING which lets you create database applications in a high level specification language. In this chapter, we will explore the capabilities of this framework.
</li></ul></div></div></div><div class="chapter" title="Chapter 1. XKJC - The Extended Kopi Java language"><div class="titlepage"><div><div><h2 class="title"><a id="_xkjc_the_extended_kopi_java_language"></a>Chapter 1. XKJC - The Extended Kopi Java language</h2></div></div></div><p>This language extends the java language’s capabilities and offer a set of additional tools.
The most important additions of the xkjc are the new types introduced and the SQL integration to java code.
To sum up, the extended kopi Java language is layer over the standard java language, meaning that all java statements are understood by the Kopi language, plus some new features and tools.
The kopi files extension is (.k).</p><div class="section" title="1.1. XKJC : The new Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_xkjc_the_new_types"></a>1.1. XKJC : The new Types</h2></div></div></div><p>Kopi introduces 6 types to the basic types available in the java language :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Date      : date values that can be null, you can also use "date" for not null Date type values.
</li><li class="listitem">
Month     : Years months values and can be null, you can use "month" for not null Month type values.
</li><li class="listitem">
Week      : Years weeks values and can be null, you can use "week" for not null Month type values.
</li><li class="listitem">
Time      : this type can be used to contain time values (hh:mm:ss), "time" for not null values.
</li><li class="listitem">
Timestamp : can contain timestamp values and null, "timestamp" for not null values.
</li></ul></div></div><div class="section" title="1.2. XKJC : Java with embedded SQL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_xkjc_java_with_embedded_sql"></a>1.2. XKJC : Java with embedded SQL</h2></div></div></div><p>This language allows developer to define triggers and actions in the XKJC language that is a superset of Java with embedded SQL. XKJC allows the mixing of Java-typed expression from both SQL and Java.</p><p>Since SQL statements are parsed, it allows one to write a very clear code as compared to JDBC (see XKJC vs JDBC section). It allows one to make requests with embedded Java expressions computed at runtime. It comes with a support for BLOB and Java serialization mechanism, allowing to store Java objects in any JDBC database and to retrieve them both nicely and efficiently.</p><p>As in SQL all types have a NULL value, the distinction between primitive types and Object types of the Java language are problematic. To handle this, XKJC contains an operator overloading capability that allows the mixing of primitive types with objects.</p><p>The mechanism of overloading looks like the one provided by C+.+  compiler except that only expression operator are overridable (<code class="literal">, -, *, /, %, ==, !=, &amp;, |, &lt;&lt; &gt;&gt;, &gt;&gt;&gt;, ^, ~, +</code>, –) and the cast operation. There is no implicit conversion, and that make it easy to understand.</p><p>There is an example of a typical XKJC program:</p><pre class="programlisting">#cursor(int id) {
  SELECT Vector Obj
  FROM   BLOBS
  WHERE  ID = :id
} typed;
typed.open(6);
if (typed.next())
  for (int i = 0; i &lt; typed.Obj.size(); i++)
    System.out.println("vect(" + i + "): " + typed.Obj.elementAt(i));
typed.close();</pre><p>By providing an easy way to include SQL statement inside your Java code (not between double quote), XKJC made it more easy to read and maintain. With explicit typing the compiler check that expression are correct and involve the overloading mechanism to execute expression such as:</p><div class="section" title="1.2.1. Connections"><div class="titlepage"><div><div><h3 class="title"><a id="_connections"></a>1.2.1. Connections</h3></div></div></div><p>By providing explicit connection to SQL statement you are able to work on more than one database at the same time. But since common applications work with only one database, we provide a mechanism of implicit transaction that allows to save time by wrinting:</p><pre class="programlisting">#execute{SELECT COUNT(*) FROM Cars INTO count};</pre><p>instead of:</p><pre class="programlisting">#execute[Main.getDatabase().getFreeConnection()] {
  SELECT COUNT(*) FROM Cars INTO count
};</pre></div><div class="section" title="1.2.2. Cursors"><div class="titlepage"><div><div><h3 class="title"><a id="_cursors"></a>1.2.2. Cursors</h3></div></div></div><p>The cursor are the common way to get more than one row of data from the database. It’s like ResultSet but it’s typed:</p></div><div class="section" title="1.2.3. SQL SELECT INTO Statement"><div class="titlepage"><div><div><h3 class="title"><a id="_sql_select_into_statement"></a>1.2.3. SQL SELECT INTO Statement</h3></div></div></div><p>The only SQL statement in XKJC is the #execute that allow to fetch data from the database with a “SELECT INTO”.</p><p>Examples:</p><pre class="programlisting">   1. #execute {
      SELECT String name, Image image, BigDecimal speed
      FROM   Cars
      WHERE  ID = 1
      INTO   theName, theImage, theSpeed
    };


   2.  #execute {
      SELECT String name
      FROM   Cars
      WHERE  ID =:id
      INTO   names[id]
    };


   3. #execute[conn] {
      SELECT COUNT(*)
      FROM Cars
      INTO count
    };</pre><p>The last example use an explicit connection while the others use an implicit connection (ie, the context should inherit from DBContextHandler and its default connection will be used).</p></div><div class="section" title="1.2.4. SQL Expressions"><div class="titlepage"><div><div><h3 class="title"><a id="_sql_expressions"></a>1.2.4. SQL Expressions</h3></div></div></div><p>SQL expression returns an int value that correspond to the number of row modified by the expression. An expression can use a cursor to identifie a row of the database (WHERE CURRENT OF) with fully implemented JDBC drivers.</p><p>Examples:</p><pre class="programlisting">    1. #update {
      UPDATE Cars
      WHERE  ID =:id
      SET    name = :(javaName + '-' + id)
    };

    2. #update(cursor) {
      UPDATE Cars
      SET    name = :(javaName + '-' + id)
    };


    3. #update [conn] {
      DELETE FROM Cars
      WHERE :id &gt; 10
    };</pre><p>The last example use an explicit connection while the others use an implicit connection (ie, the context should inherit from DBContextHandler and its default connection will be used).</p></div><div class="section" title="1.2.5. Transactions"><div class="titlepage"><div><div><h3 class="title"><a id="_transactions"></a>1.2.5. Transactions</h3></div></div></div><p>Every SQL statements should be executed within transaction. This allows to re-execute statements interrupted by deadlock (after asking the user if he wants to) or abort a whole transaction if something is wrong (like if a Java exception is thrown). The syntax is:</p><pre class="programlisting">#protected([``an optional message'']){
  ...
  ... // a list of Java and SQL statements
  ...
};</pre></div></div></div><div class="chapter" title="Chapter 2. VLIB - The Visual Kopi application framework"><div class="titlepage"><div><div><h2 class="title"><a id="_vlib_the_visual_kopi_application_framework"></a>Chapter 2. VLIB - The Visual Kopi application framework</h2></div></div></div><p>The visual Kopi Framework is an application framework based using the XKJC language in order to create database applications easily.
In this chapter we will se how to create kopi powered forms,reports and print pages.</p><div class="section" title="2.1. Generalities"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_generalities"></a>2.1. Generalities</h2></div></div></div><p>In this section we will provide the definitions you may need in order to fully understand the syntax explanations in the rest of the chapter.
We will also provide the standard types used in the visual kopi framework.</p><div class="section" title="2.1.1. Syntax terms"><div class="titlepage"><div><div><h3 class="title"><a id="_syntax_terms"></a>2.1.1. Syntax terms</h3></div></div></div><p>During this chapter, you will have many <span class="strong"><strong>Syntax</strong></span> sections containing different keywords and special characters :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><span class="emphasis"><em>SimpleName and QualifiedName</em></span></strong></span>
</li></ul></div><p>When setting up your own application, you will often have to enter a name in order to define either a field, a block, a page or a form. You will then have to make use of either a simple or a qualified name.</p><p>A SimpleName consists of a character row in which neither spaces nor points are permitted.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">StudentGroup2</pre><p>A QualifiedName is a row of characters in which points are allowed.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">StudentGroup2.ViennaUniversity</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><span class="emphasis"><em>Parameters</em></span></strong></span>
</li></ul></div><p>You can also find parameters with types in the syntax blocks;</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">Integer x
String name
Fixed y</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><span class="emphasis"><em>Special Characters</em></span></strong></span>
</li></ul></div><p>These characters may be found ins syntax block and defines the rules of the syntax:</p><p>[ ]  : if an element in put between [ ] that means it’s optional.
*    : if an element or expression is followed by *, then it can be inserted zero or more times
+    : if an element or expression is followed by +, then this element need to be inserted at least one time, or more
|    : means Or
" "  : if and element or expression is put between " ", then it’s a keyword of the language.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="screen">ItemDefinition  : "FORM" String formTitle ["IS" QualifiedName]
                  ["IMPLEMENTS" QualfiedName [,QualifiedName]* ]</pre></div><div class="section" title="2.1.2. Predefined Field Types"><div class="titlepage"><div><div><h3 class="title"><a id="_predefined_field_types"></a>2.1.2. Predefined Field Types</h3></div></div></div><p>Every form or report field In visual kopi have field type that can be one of the 12 ready to use predefined types :</p><pre class="programlisting">- FIXED     // used to insert fixed values
- IMAGE      // used to insert images
- INTEGER    // used to insert integer values
- STRING     // used to insert string values
- TEXT       // used to insert text values
- DATE       // used to insert a date value
- BOOL       // used to insert a true or false value
- COLOR      // used to set the fields color
- MONTH      // used to insert years months value
- TIME       // used to insert a hours:minutes time value
- TIMESTAMP  // used to insert a timestamp value
- WEEK       // used to insert years weeks  value</pre><div class="section" title="The STRING Field Type"><div class="titlepage"><div><div><h4 class="title"><a id="_the_string_field_type"></a>The STRING Field Type</h4></div></div></div><p>A STRING is used to enter characters which can be either letters, numbers or both. The width has always to be given. Moreover, you can optionaly indicate how many rows it will contain and how many will finally be displayed on the form. If these optional arguments are used, you have to indicate the carraige return method by specifying either the FIXED ON or the FIXED OFF option to avoid compilation errors.
There are also three other options you can use in order to modify the String’s case :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
CONVERT NAME  (Converts the first letter of each word to capital letter)
</li><li class="listitem">
CONVERT UPPER (Convert the whole text to capital letters)
</li><li class="listitem">
CONVERT LOWER (Converts the whole text to normal letters)
</li></ul></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">StringType   : "STRING" (Integer width ,Integer height ,Integer visible)
               [FixOption]
               [StringFormat]

FixOption    : "FIXED" "ON"
               "FIXED" "OFF"

StringFormat : "CONVERT" "UPPER"
               "CONVERT" "LOWER"
               "CONVERT" "NAME"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">STRING (40,10,4)
FIXED ON
CONVERT UPPER</pre><p>In this example, the text inserted will contain up to 40 characters and up to 10 rows. However, only the first 4 rows will be displayed on the form. Moreover, All the letters in the text will be converted to capital letters.</p></div><div class="section" title="The TEXT Field Type"><div class="titlepage"><div><div><h4 class="title"><a id="_the_text_field_type"></a>The TEXT Field Type</h4></div></div></div><p>A Text and a String are similar apart from the fact that in a text, two parameters have always to be given: namely the width and the height of the field whereas you only need to determine the width in a string.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">TextType      : "TEXT" (Integer width ,Integer height ,Integer visible)
                [FixOption]

[FixOption]   : "FIXED" "ON"
                "FIXED" "OFF"</pre><p>For example, you can write STRING (40, 10, 4) or STRING (40) but you have to write TEXT (40, 10) or TEXT (40, 10, 4).</p></div><div class="section" title="The IMAGE Field Type"><div class="titlepage"><div><div><h4 class="title"><a id="_the_image_field_type"></a>The IMAGE Field Type</h4></div></div></div><p>This field type is used to insert an illustration or a picture. When introducing an IMAGE, you have to determine its width and height. These values have to be integers and are measured in pixel. In this case, the two attributes are compulsory.The field will look like a file chooser that lets you choose and image file to show in the field.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ImageType : "IMAGE" (Integer width , Integer height)</pre><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">IMAGE(20,10)</pre><p>In this field, the image will have a width of 20 pixel and a height of 10 pixel.</p></div><div class="section" title="The FIXED Field Type"><div class="titlepage"><div><div><h4 class="title"><a id="_the_fixed_field_type"></a>The FIXED Field Type</h4></div></div></div><p>A FIXED is used to insert numbers, integers, fixed point numbers. Fraction numbers are entered with the field type FRACTION.
The maximal width has to be determined for all them. In case of a fixed point number FIXNUM, the maximal scale i.e the number of characters standing after the comma has also to be defined.
Also the comma has to be counted as a character. Only the width is to be defined in a FRACTION.
You can also set the minimum and the maximum values for the FIXNUM field with the optional parameters MINVAL and MAXVAL.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">FixedType   :  "FIXNUM" (Integer width ,Integer scale)
               ["MINVAL" Fixed minValue]
               ["MAXVAL" Fixed maxValue]

FractionType : "FRACTION" (Integer width)
               ["MINVAL" Fixed minValue]
               ["MAXVAL" Fixed maxValue]</pre><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">FIXED(4,2)      // for 1,25
  MINVAL 0
  MAXVAL 3.0


FRACTION(7)    //  for 1 35/64
  MINVAL 0
  MAXVAL 25</pre></div><div class="section" title="The INTEGER Field Type"><div class="titlepage"><div><div><h4 class="title"><a id="_the_integer_field_type"></a>The INTEGER Field Type</h4></div></div></div><p>Integer field type is  LONG is used to insert integers. Only the text width is to be defined. The MINVAL and MAXVAL options are also available for this type.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">IntegerType:   "LONG" (Integer width)
               ["MINVAL" Integer minValue]
               ["MAXVAL" Integer maxValue]</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">LONG(6)
  MINVAL 0
  MAXVAL 100</pre></div></div><div class="section" title="2.1.3. Code Field Types"><div class="titlepage"><div><div><h3 class="title"><a id="_code_field_types"></a>2.1.3. Code Field Types</h3></div></div></div><p>In addition to the predefined field types already available in visual kopi, you can define more specific types which are the ENUM type and the CODE type. Unlike the predefined field types, these types have to be set in the Type definition type of the form before you can use them in the fields.</p><div class="section" title="The ENUM Type"><div class="titlepage"><div><div><h4 class="title"><a id="_the_enum_type"></a>The ENUM Type</h4></div></div></div><p>The ENUM type means enumeration or listing. An enumeration definition is made up of one or several strings and only the strings you have listed can be entered in the field.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">EnumType:   "ENUM" (EnumList)

EnumList:   String member [,EnumList]</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">ENUM ("X-Small","Small","Medium", *  Large", *  X-Large" )</pre></div><div class="section" title="The CODE types"><div class="titlepage"><div><div><h4 class="title"><a id="_the_code_types"></a>The CODE types</h4></div></div></div><p>There are four different sorts of CODE :
* The CODE BOOL
* The CODE LONG
* The CODE FIXED
* The CODE STRING</p><p>These types enable you to have a list of item-value pairs, the items will be displayed in the field and the values will be assigned instead.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>The Type CODE BOOL</strong></span>
</li></ul></div><p>In a CODE BOOL or BOOLEAN you have to assign a Boolean value to the item you have entered. Boolean values are values like "True" or "False" and "Yes" or "No".</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">CodeBooleanType : "CODE" "BOOL" "IS"
                  CodeBooleanList
                  "END" "CODE"

CodeBooleanList : CodeBoolean  [CodeBooleanList]

CodeBoolean     : String code "=" Boolean value</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">CODE BOOL IS
  "married" = true
  "single"  = false
END CODE</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>The Type CODE LONG</strong></span>
</li></ul></div><p>In a CODE LONG, you assign to each String item you have entered a LONG value.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">CodeIntegerType : "CODE" "LONG" "IS"
                  CodeIntegerList
                  "END" "CODE"

CodeIntegerList : CodeInteger  [CodeIntegerList]

CodeInteger     : String code "=" Integer value</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">CODE LONG IS
  "Monday" = 1
  "Tuesday" = 2
  "Wednesday" = 3
  "Thursday" = 4
  "Friday" = 5
  "Saturday" = 6
  "Sunday" = 7
END CODE</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>The Type CODE FIXED</strong></span>
</li></ul></div><p>In a CODE FIXED, each item you have entered will get a FIXED value, i.e integers, fixed point numbers and fraction numbers.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">CodeFixedType : "CODE" "FIXED" "IS"
                [CodeFixedList]
                "END" "CODE"

CodeFixedList : CodeFixed  [CodeFixedList]

CodeFixed     : String code "=" Fixed value</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">CODE FIXED IS
  "piece" = 1.00
  "per cent" = 0.01
END CODE</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>The Type CODE STRING</strong></span>
</li></ul></div><p>In a CODE STRING, each item you have entered will get a STRING value, this can be useful for shortcut of long strings for example.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">CodeStringType : "CODE" "STRING" "IS"
                 [CodeStringType]
                 "END" "CODE"

CodeStringType : CodeString  [CodeStringType]

CodeString     : String code "=" String value</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">CODE STRING IS
  "JDK" = "Java Development Kit"
  "JRE" = "Java Runtime Environment"
END CODE</pre></div></div><div class="section" title="2.1.4. The LIST command"><div class="titlepage"><div><div><h3 class="title"><a id="_the_list_command"></a>2.1.4. The LIST command</h3></div></div></div><p>Once you have defined a field type, you can make use of the LIST command in order to refer the user to a list or a table in the database which will help him when filling in the form in question.
If you refer a field type to a certain table, the field will get an icon on which you can click in order to retrieve this table. As this command connects the user with a certain table, you have to enumerate all columns of the table which information could be helpful for the user.
In so doing, you will then have to enter at least one column. The information contained in the first element of the list must have the same standard type as the defined type as it is the one which will be entered in the field in question. In addition, you may choose to refer to an existing form (that should extend the VDictionaryForm class) using either the NEW command to get a button on the bottom of the list allowing you to get to the referred form, or the ACCESS command to bypass the list and get directly to the referred form.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">List        : "LIST" String tableName ["NEW" | "ACESS" QualifiedName ]
              "IS" ListColumns
              "END" "LIST"

ListColumns : ListColumn  [ListColumns]

ListColumn  : [String field "="] SimpleName ":" Predefined Field Type</pre><p>This command is usually used when defining a new type, here is an example where we define the Lecturer Type as a STRING(8) value from the Symbol field of the "Lecturer" table on the database, when clicking on a field of Type Lecturer, you will have a list with three columns (Symbol, Surname and Lesson) retrieved from the "Lecturer" table. Selecting a row from this list will put the symbol value in the field.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">TYPE Lecturer IS
  STRING (8)
  CONVERT UPPER

  LIST "Lecturer" IS
    "Symbol" = Symbol : STRING (8)
    "Name" = Name : STRING (40)
    "Surname" = Surname : STRING (40)
    "Lesson" = Lesson : STRING (20)
  END LIST
...
END TYPE</pre><div class="section" title="The SELECT command"><div class="titlepage"><div><div><h4 class="title"><a id="_the_select_command"></a>The SELECT command</h4></div></div></div><p>As you had the possibility to call up a list or a table from the database with the option LIST, you now can make Kopi sort out information from a whole list or a table which the option SELECT and this, according to criteria you have to define. Let’s say you want to view the degrees which can be achieved in a certain year. For this, you have to use the SELECT command as you see in the following rows:</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">TYPE CurrentDegree (Integer year) IS
     STRING (8)
       CONVERT UPPER
  LIST{(
        SELECT Symbol, Description
        FROM   Degree
        WHERE Year = : (year)
        )} IS

        "Symbol" = Symbol : STRING (8)
        "Description" = Description : STRING (40)
  END LIST
END TYPE</pre><p>"Degree" is the database table to which we have to access in order to select the information. The command SELECT is used in order to enter the columns in which Kopi has to make its research. After FROM, you have to enter the table from which these columns are to be selected and after WHERE, you have to enter the conditions according to which this selection has to be carried out.</p><p>The sign "=" means the value of the data delivered after the selection must correspond to the conditions you have entered.
The sign ":" inserts one Java expression. After this Java expression, you can insert a SQL expression again. (See JLS 15.27)
Finally, you have to define for each of them the field type.</p><p>As a result of your selection, you will then have a table with two columns which will contain the different sorts of degrees achievable in the year you have entered.</p></div></div></div><div class="section" title="2.2. Visual Kopi Forms"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_visual_kopi_forms"></a>2.2. Visual Kopi Forms</h2></div></div></div><p>The aim of Kopi is to enable you to create applications. An application is made up of forms. A <span class="strong"><strong>form</strong></span> is a set of <span class="strong"><strong>pages</strong></span> consisting of <span class="strong"><strong>blocks</strong></span>. A <span class="strong"><strong>block</strong></span> is nothing else than a table which is divided into columns (vertical) and rows (horizontal). A row is made up of <span class="strong"><strong>fields</strong></span>, and each <span class="strong"><strong>field</strong></span> contains a data value at the intersection of a row and a column that can be of different <span class="strong"><strong>Types</strong></span>.
By the end of this chapter, you will learn how to create a form, but before, you need to learn how to create a field and how to form blocks.</p><div class="section" title="2.2.1. Creating Form Fields"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_form_fields"></a>2.2.1. Creating Form Fields</h3></div></div></div><p>In Visual Kopi, a fields are containers in which you can define different types of data. A field definition begins with an access modifier followed by an optional SimpleName and ends with END FIELD.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">FieldDeclaration  : AccessModifier [FieldHeader] [HelpText] FieldType
                    FieldBody
                    "END" "FIELD"

FieldHeader       : [(Integer multiField)] [SimpleName] [FieldPosition]
                    [FieldLabel]
FieldBody         : "IS" QualifiedName [FieldColumns] | [FieldAligement]
                    [FieldDropList]     [FieldOptions]    [FieldColumns]
                    [FieldCommands] [FieldTriggers]</pre><div class="section" title="Field Access Modifiers"><div class="titlepage"><div><div><h4 class="title"><a id="_field_access_modifiers"></a>Field Access Modifiers</h4></div></div></div><p>An access modifier determines the way the application user will have to handle each field in a form as well as the field accessibility. This command is compulsory. There are 4 sorts of access modifier:</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">AccessModifier:   "MUSTFILL"
                  |
                  "VISIT"
                  |
                  "SKIPPED"
                  |
                  "HIDDEN"</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
MUSTFILL : As indicated, a MUSTFILL field has to be filled by the user. This field will be colored in blue.
</li><li class="listitem">
VISIT    : A VISIT field is a field which the user can fill if he wants to. In Visual Kopi, this field will be colored in green.
</li><li class="listitem">
SKIPPED  : A SKIPPED field is a field which is displayed on the form but which the user can not overwrite. A field is skipped if the user needs to know the information written in it. This field is always colored in black.
</li><li class="listitem">
HIDDEN   : A HIDDEN field that is not displayed on the form as the information it provides is of no importance for the user, this kind of fields is usualy used for database table join operations or for ID fields.
</li></ul></div><p>As the user moves from a field to another when filling the form, the current field is always colored in red.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">MUSTFILL Year
  ...
END FIELD

HIDDEN ID
  ...
END FIELD</pre></div><div class="section" title="Multiple fields and Single fields"><div class="titlepage"><div><div><h4 class="title"><a id="_multiple_fields_and_single_fields"></a>Multiple fields and Single fields</h4></div></div></div><p>After specifying the field’s Access modifier, you can use an integer to transform the field to a multiple field, meaning that the field is displayed as much times as the integer you defined.
The fields created will have the same name plus the number of the field.
<span class="strong"><strong>Example</strong></span></p><pre class="screen">VISIT (3) Email
  ....
END FIELD</pre><p>This means that the Email field will be displayed 3 times on the form with the names Email1 Email2 and Email3.</p></div><div class="section" title="Field Position"><div class="titlepage"><div><div><h4 class="title"><a id="_field_position"></a>Field Position</h4></div></div></div><p>This entry defines the position of the field in the current block. HIDDEN fields does not have positions, and in multiple block (Defined in the  Blocks creation Section of this document) you may use the NO DETAIL Block option to pass positioning fields.
There are two possibilities to define the field position.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">FieldPosition : "AT" "&lt;"Integer row  [,Integer column [-Integer multi]]"&gt;"
                | "FOLLOW" SimpleName</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
<span class="strong"><strong>Absolute Position With AT</strong></span>
</p><div class="variablelist"><dl><dt><span class="term">
You can define it according to one integer or more: 
</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
AT &lt;Integer row&gt;
</li><li class="listitem">
AT &lt;Integer row , Integer column&gt;
</li><li class="listitem">
AT &lt;Integer row, Integer column-Integer multifield&gt;
</li></ul></div></dd></dl></div></li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT (4) Customer AT &lt;1, 1-4&gt;
  ...
END FIELD</pre><p>The first integer indicates the row number while the second defines the column.
In fact, Kopi automatically divides up the window in rows and columns when setting up a form.
 When defining the width of a column, thus,
it always adopts the width of the longest field. Since the form wide is not unlimited,
you can put a long field in two or more columns in order to spare place as it is the case in the example above and it is usually used for multiple fields.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Relative Position With FOLLOW</strong></span>
</li></ul></div><p>You can also make use of the following structure : FOLLOW SimpleName</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT Email
  FOLLOW Name
  ...
END FIELD</pre><p>If you enter a new field with this option (in this case it would be the field "Email"), it means that this field will be placed directly next to the first field defined by the FOLLOW command (field "Name") on the same row. The two fields will then form one single column.</p></div><div class="section" title="Field label"><div class="titlepage"><div><div><h4 class="title"><a id="_field_label"></a>Field label</h4></div></div></div><p>The field label is optional, you declare it with the LABEL command that comes just after the position definition, the syntax is the following :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">FieldLabel : "NO" "LABEL" | "LABEL" [ String label [,String labels]* ]</pre><p>If you don’t want your field to have a label, you can use the NO LABEL command, otherwise use the LABEL command, in this case, either you specify a list of String separated by a comma so the first one will be the field’s label, or you do not specify any String and the SimpleName that comes after the field’s access modifier will be the field’s label.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT firstName  AT &lt;1 , 1-2&gt;
  LABEL
  ...
END FIELD

SKIPPED secondName
  FOLLOW firstName
  LABEL "The second Name","another Label for this field"
  ...
END FIELD</pre></div><div class="section" title="Field Help Text"><div class="titlepage"><div><div><h4 class="title"><a id="_field_help_text"></a>Field Help Text</h4></div></div></div><p>HELP is used to insert an explanation text for the application user in order to help him filling in the form. This Help text will then be displayed when the user places the mouse on the field.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">HelpText:   String HelpText</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">MUSTFILL Lesson
  LABEL
  HELP   "The lesson you would like to attend"
  ...
END FIELD</pre></div><div class="section" title="Field Types"><div class="titlepage"><div><div><h4 class="title"><a id="_field_types"></a>Field Types</h4></div></div></div><p>The field type is a required entry, you may enter a predefined field type :</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">MUSTFILL
  NO LABEL
  LONG(10)
END FIELD


VISIT Name
  STRING(20)
END FIELD</pre><p>You can also use self defined field types that you have previously defined in the type definition section of your form.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">SKIPPED objectList
  LABEL
  TYPE Objects
END FIELD</pre><p>In this example, Objects is a type you should have defined previously in type definition section of the form using standard types, CODE types, ENUM types, LIST and SELECT command …</p></div><div class="section" title="Field Alignment"><div class="titlepage"><div><div><h4 class="title"><a id="_field_alignment"></a>Field Alignment</h4></div></div></div><p>This command is used to define the localization of the field’s content inside the field. There are three types of alignment.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
ALIGN RIGHT the value is displayed at the right inside the field
</li><li class="listitem">
ALIGN LEFT the value is displayed at the left inside the field
</li><li class="listitem">
ALIGN CENTER the value is centered in the field
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT field
  LABEL
  FIXNUM(9, 4)
  ALIGN CENTER
  ...
END FIELD</pre></div><div class="section" title="Field Drop files"><div class="titlepage"><div><div><h4 class="title"><a id="_field_drop_files"></a>Field Drop files</h4></div></div></div><p>This command is used to make a field accept to drop files into it, meaning you can drag files and drop them in your field.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">DroppableDefinition : "DROPPABLE" ExtensionList
ExtentionList       : String extension [,ExtenstionList]</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT images
  LABEL
  STRING(20)
  DROPPABLE("pdf", "jpeg", "tif", "tiff")
END FIELD</pre><p>In this example, you can drag image files and drop them in the field named "images".</p></div><div class="section" title="Field Options"><div class="titlepage"><div><div><h4 class="title"><a id="_field_options"></a>Field Options</h4></div></div></div><p>In this part of the field definition, you can use one or more option from the 10 options available for fields in Kopi, here is the a list of these field options.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
NOECHO               : If this option is used, characters typed in the field will not be displayed and a star(*) will be displayed instead, this option is useful for password fields.
</li><li class="listitem">
NOEDIT               : This option makes it impossible to change the data of the field or to overwrite it.
</li><li class="listitem">
SORTABLE             : This option adds two opposed arrows icons(up and down) just before the field, clicking on the icon changes the way data are sorted in the field, you can click the icon three times to have ascending sort, descending sort and default sort,
</li><li class="listitem">
TRANSIENT            : This option make the field transient, meaning that the system can no trail it, if a transaction  calls this field and then this transaction is aborted, the field will not be able to backup or roll-back to its original value, besides this option makes changes ignored for this field.
</li><li class="listitem">
NO DELETE ON UPDATE  : If the field is a lookup is a column of a lookup table, using this option prevent the system to clear the field when inserting new rows or updating rows.
</li><li class="listitem">
NO DETAIL            : If the block is in detailed, using this option on a field make it invisible in the detail.
</li><li class="listitem">
NO CHART             : If the block is multiple, using this option on a field exclude it from the chart.
</li><li class="listitem">
QUERY UPPER          : Whatever the string you input, this option will make kopi transform it to capital letters.
</li><li class="listitem">
QUERY LOWER          : the opposite of the previous option it transform strings to lower case.
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT name
  LABEL
  STRING(10)
  QUERY LOWER
  NOECHO
END FIELD</pre></div><div class="section" title="Field Columns"><div class="titlepage"><div><div><h4 class="title"><a id="_field_columns"></a>Field Columns</h4></div></div></div><p>The COLUMNS field option is used to establish a connection between a certain column in the database with the field.Once such connection established, the field will have a direct access to the database column allowing insertions, modification …+
You may enter this option in order to specify which table and which column the field refers.
The same field can refer to more than one column.
 You can also use the KEY option to specify a key column in the database or the NULLABLE option to specify an outer joint.+
Two more option are available with the COLUMNS command, the index and the priority options.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">FieldColumns : "COLUMNS" (ColumnList) [ColumnIndex] [ColumnPriority]
ColumnList   : Column  [, Column ]
Column       : ["KEY"] ["NULLABLE"] QualifiedName</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT Invoice AT &lt;1, 2&gt;
  LABEL "Invoice Number"
  STRING(10)
  COLUMNS(I.NumInvoice) //I is the invoices table for example
  ....
END FIELD</pre><p>Note that a field can be connected to more than one table and column. In this case, the formula you will type will be:</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VISIT Invoice AT &lt;1, 2&gt;
  LABEL "Invoice Number"
  STRING(10)
  COLUMNS(KEY I.NumInvoice, ID.Invoice) //
  ....
END FIELD</pre><p>In this example, I is the invoices table  and IP is the invoice details table and they have an outer join connection throw columns NumInvoice and Invoice.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Indexes</strong></span>
</li></ul></div><p>This option is used to define a value in the database which is to remain unique so that it can not appear anymore in another field of the same column. An INDEX is always to be followed by one or more integers. This integer can take a value between 0 and 31,both minimal and maximal values are also included.</p><p>Let’s sum up with the following syntax:</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ColumnIndex : "INDEX" Integers
Integers    : Integer index  [Integers]</pre><p>If two or more fields are given the same index value, it means that two similar combinations of these field values will not be accepted.</p><p>For example, two different lessons cannot be given in the same room. In this case, the three fields, namely the fields "professor", "time" and "lesson" are to be attributed the same index. Thus, at least one of the three values needs to be changed so that the combination can be accepted by the machine.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">MUSTFILL "Lesson"
  LABEL
  HELP "The lesson you have to attend to"
  LONG (11)
  COLUMN (LEC.Lesson)
  INDEX 0
END FIELD


VISIT "Lecturer"
  LABEL
  LONG(11)
  COLUMN (LES.Lecturer)
  INDEX 0
END FIELD


MUSTFILL "Time"
  STRING(11)
  COLUMN (LES.Time)
  INDEX 0
END FIELD</pre><p>However, this example would implicate a professor can give two different lessons at the same time. In order to avoid such errors, you can attribute one field two or more indexes. So you can associate the two fields "professor" and "time" together. Thus, you will have:</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">MUSTFILL "Lesson"
  LABEL
  HELP "The lesson you have to attend to"
  LONG (11)
  COLUMN (LEC.Lesson)
INDEX 0
END FIELD

VISIT "Lecturer"
  LABEL
  LONG
  COLUMN (T.Lecturer)
  INDEX 0 1
END FIELD

MUSTFILL "Time"
  STRING
  COLUMN (LEC.Time)
  INDEX 1
END FIELD</pre><p>In this case, notice that the "Lecturer" field has been associated
with two indexes: 0 and 1.</p><p>The index value is ascendant. When attributing an index value to a field combination, you shall always take the value nexting that you have taken the last.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Priority</strong></span>
</li></ul></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ColumnPriority:   "PRIORITY" ["-"] Integer priority</pre><p>This option is used in order to define the column order within a list when this list is displayed. A PRIORITY is always followed by an integer according to the structure given above. The column with the biggest priority value will appear on the extreme left side of the table and the one with the least value will be on the extreme right side.</p><p>We shall notice that negative values are also permitted in this option. However, the minus sign ("-") standing before the number does not have any influence over its value but simply indicates the way all the information will be sorted out within a column. Actually, the different fields are always sorted in the ascending way, i.e from A to Z in case of an alphabetical text and from 1 to x+1 for numbers. Now, if the integer is preceded by a minus, the column content will be sorted in the other way round.</p><p><span class="strong"><strong>Example</strong></span></p><p>If columns "Surname", "Name" and "Date of Birth" are
respectively given the priorities 3,4 and 1, "Name" will come
first and will be followed by "Surname" and "Date of Birth".
The same order applies with the values 3, -4 and 1, with the only
difference that the names will be sorted out from Z to A.</p><p>Moreover, two columns with the same priority will be displayed according to the same order in which the user has listed them.</p></div><div class="section" title="Field Commands"><div class="titlepage"><div><div><h4 class="title"><a id="_field_commands"></a>Field Commands</h4></div></div></div><p>Once you have defined the columns , you may define the field commands. There are three types of field command:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Standard Field Commands (no Modes)
</li><li class="listitem">
Commands using Modes
</li><li class="listitem">
Access modifiers using Modes
</li></ul></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ModeAndCommands : ModeList  AccessModifier | [ModeList] Command

Command         : "COMMAND" QualifiedName | "COMMAND" CommandBody
                  "END" "COMMAND"

CommandBody     : "ITEM" SimpleName  CommandAction

CommandAction   : "ACTION" [(Parameter)] { KopiJavaCode  }
                  |
                  "EXTERN" QualifiedName | "CALL" SimpleName

ModeList        : "ON" Modes

Modes           : Mode  [, Modes ]

Mode            : "QUERY" | "INSERT" | "UPDATE"</pre></div><div class="section" title="Standard Field Command"><div class="titlepage"><div><div><h4 class="title"><a id="_standard_field_command"></a>Standard Field Command</h4></div></div></div><p>The command QualifiedNames that we will can be kopi predefined commands or you can make new Actors and commands you can use in the field command definition.
There are five ways in calling a standard command</p><pre class="programlisting">"COMMAND" QualifiedName

Example :
COMMAND FormReset</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "CALL" SimpleName "END" "COMMAND"

Example
COMMAND
  ITEM Autofill
  CALL function
END COMMAND</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "EXTERN" QualifiedName "END" "COMMAND"

Example
COMMAND
  ITEM Autofill
  EXTERN filepath.function
END COMMAND</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "ACTION" (VField SimpleName) {Kopi-Java Code}
"END" "COMMAND"

Example
COMMAND
  ITEM Clear
  ACTION (VField f) {
    f.setDefault ();
  }
END COMMAND</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "ACTION" {Kopi-Java Code}
"END" "COMMAND"</pre></div><div class="section" title="Field Command using Modes"><div class="titlepage"><div><div><h4 class="title"><a id="_field_command_using_modes"></a>Field Command using Modes</h4></div></div></div><p>All the previous command definition ways can be preceded by one mode ore more. There are three sorts of mode which are to be sorted according to the following hierarchy:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
QUERY to start an inquiry within the database
</li><li class="listitem">
INSERT to create a new row in the database
</li><li class="listitem">
UPDATE to enter new information within a row
</li></ul></div><p>So you will have: ON Mode COMMAND, ON MODE QualifiedName …</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">ON QUERY, UPDATE COMMAND InsertMode</pre><p>If you have entered a mode before the COMMAND, it means this COMMAND can only be invoked if the block is in the mode you have determined.</p></div><div class="section" title="Field Access modifiers using Modes"><div class="titlepage"><div><div><h4 class="title"><a id="_field_access_modifiers_using_modes"></a>Field Access modifiers using Modes</h4></div></div></div><p>This command type is used to change the access to the field using the block Mode. In fact the access is not changed directly but the higher access possible is set to the indicated access.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">ON QUERY,INSERT HIDDEN</pre><p>In this example, we have determined that the field will be invisible
if the block is in the QUERY  or the INSERT mode.</p></div><div class="section" title="Field Triggers"><div class="titlepage"><div><div><h4 class="title"><a id="_field_triggers"></a>Field Triggers</h4></div></div></div><p>Triggers are events that you can use to execute actions when they occur, there are field triggers, block triggers and form triggers that you can use following this syntax :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">Trigger      : EventList TrigerAction

EventList    : Event [,EventList]

TrigerAction : SimpleName | "EXTERN" QualifiedName | {KOPI_JAVA code}
               | (VField SimpleNAme){KOPI_JAVA code}</pre><p>Field Triggers are events that concern the fields behavior, here is a list of all kopi field triggers available :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
PREFLD     : is executed upon entry of field
</li><li class="listitem">
POSTFLD    : is executed upon exit of field
</li><li class="listitem">
POSTCHG    : is executed on field content change
</li><li class="listitem">
PREVAL     : is executed before validating any new entry
</li><li class="listitem">
VALFLD     : is executed after field change and validation
</li><li class="listitem">
VALIDATE   : this is the same trigger as VALFLD
</li><li class="listitem">
DEFAULT    : Defines the default value of the field to be set if the setDefault() method is called (this method is automatically called when the user choose the insert command)
</li><li class="listitem">
FORMAT     : Not defined actually
</li><li class="listitem">
ACCESS     : ACCESS is a special trigger that defines how a field can be accessed. This trigger must return one of these values ACS_SKIPPED, ACS_HIDDEN, ACS_VISIT or ACS_MUSTFILL.
</li><li class="listitem">
VALUE      : equates the value of two fields
</li><li class="listitem">
AUTOLEAVE  : must return a boolean value, if "true" the cursor will move to the next field
</li><li class="listitem">
PREINS     : is executed before inserting a row of the database
</li><li class="listitem">
PREUPD     : is executed before updating a row of the database
</li><li class="listitem">
PREDEL     : is executed before deleting a row of the database
</li><li class="listitem">
POSTINS    : is executed after inserting a row of the database
</li><li class="listitem">
POSTUPD    : is is executed after updating a row of the database
</li></ul></div><p><span class="strong"><strong>Examples</strong></span></p><pre class="programlisting">VISIT EMail
  LABEL "Email"
  HELP "The electronic address of the lecturer"
  STRING 40
  COLUMNS (B.Mail)
  DEFAULT {
    @N.EMail = "@";
  }
END FIELD</pre><p>the "@N.EMail" expression means : bloc N, field EMail</p><pre class="screen">MUSTFILL Lecturer
  LABEL
  FIXED (5,2)
  MINVAL 0
  COLUMNS (T.Lecturer)
  PRIORITY 1
  ACCESS {
    return (T.Art.getInt()==0? ACS_HIDDEN; ACS_MUSTFILL);
  }
END FIELD</pre></div><div class="section" title="Field Definition from another Field"><div class="titlepage"><div><div><h4 class="title"><a id="_field_definition_from_another_field"></a>Field Definition from another Field</h4></div></div></div><p>You can also create a field without declaring any field alignment, field option, mode, command or field trigger. However, the column, index and priority definitions are permitted.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">HIDDEN Firm
  LONG (11)
  IS F.ID
END FIELD</pre><p>IS is used to equate a field with another one. In this example, the field "Firm" is equated with the field "F.ID".That means that the Firm field will always have the same value as the F.ID field.</p></div></div><div class="section" title="2.2.2. Creating Form Blocks"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_form_blocks"></a>2.2.2. Creating Form Blocks</h3></div></div></div><p>As you already know, a form is composed of blocks. A block is a set of data which are stocked in the database and shown on a form. A block is created in order to either view the content of a database, to insert new data in the database or to update existing data in the database. A Block will always begin with BLOCK and end with BLOCK END, when defining a block, you have to proceed according to the following structure.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">BlockDefinition : "BLOCK" (Integer buffer, Integer rows)
                  SimpleName[:SimpleName] [String blockTitle]
                  ["IS" QualifiedName] ["IMPLEMENTS"  [,QualifiedName]*]
                  BlockBody
                  "END" "BLOCK"

BlockBody       : [blockBoder] [blockAlignement] [blockHelp]
                  [blockOptions] [blockTables]
                  [blocIndices] [blockCommands] [blockTriggers] blockFields
                  [blockContextFooter]</pre><div class="section" title="Block Types"><div class="titlepage"><div><div><h4 class="title"><a id="_block_types"></a>Block Types</h4></div></div></div><p>There are actually two types of blocks in Visual Kopi, the only difference between them in the definition syntax is the buffer Integer.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
single blocks
</li></ul></div><p>A single block is a block in which only one single row of a database table is displayed on the form. Each time, the computer will memorize only one entire row and a certain quantity of ID numbers through which it will retrieve another rows from the database if you want to view them.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (1,5)
  ...
END BLOCK</pre><p>The first integer indicates the block type. In case of a single block, the first integer will always be 1. The second integer indicates the maximal number of the automatically memorized IDs.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Multiple Blocks
</li></ul></div><p>A multiple block is a block in which more than one row are displayed on the form. These rows are retrieved all at once from the database and are memorized by the computer. Actually, you can define the number of the displayed rows which can be less than this of the memorized rows. In this case, there will be no need anymore to retrieve the hidden rows from the database when you want to view them.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5)
  ...
END BLOCK</pre><p>The first integer indicates the number of rows to be automatically memorized while the second defines the number of displayed rows. Notice the first integer value must always be greater than 1.</p></div><div class="section" title="Block Names"><div class="titlepage"><div><div><h4 class="title"><a id="_block_names"></a>Block Names</h4></div></div></div><p>The name of the block is composed  SimpleName name optionally followed by a colon and a SimpleName shortcut, finally, you can specify a String for the Block title but it’s not compulsory.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5) Degree:D "Degree Block"</pre></div><div class="section" title="Block superClass and Interface"><div class="titlepage"><div><div><h4 class="title"><a id="_block_superclass_and_interface"></a>Block superClass and Interface</h4></div></div></div><p>A Block may extend a superClass and implements one or more Interface.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5) Degree:D "Degrees" IS VImportedBlock IMPLEMENTS VConstants</pre></div><div class="section" title="Block Border"><div class="titlepage"><div><div><h4 class="title"><a id="_block_border"></a>Block Border</h4></div></div></div><p>After the Block name and implementation clause, you can insert the optional border statement that defines the Block’s frame type. Besides, the Title of the block will appear only if the Block’s Border type has been specified. There are actualy four Border options :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
BORDER LINE to frame the block with lines.
</li><li class="listitem">
BORDER RAISED to enhance a block by setting it on the foreground.
</li><li class="listitem">
BORDER LOWERED to put it at the background.
</li><li class="listitem">
BORDER ETCHED to carve a frame in the form.
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5) Degree:D "Degree Block" IS VImportedBlock
BORDER RAISED</pre></div><div class="section" title="Block Alignment"><div class="titlepage"><div><div><h4 class="title"><a id="_block_alignment"></a>Block Alignment</h4></div></div></div><p>Alignment statements are useful to align a block(source block) referring to another one(target block), after the keyword ALIGN, you have to specify the referred block name followed by one or many sets of two integers separated by a minus, the sets are separated by a comma. As for the integers signification, the one in the left of the minus is the source block column number while the other one is for the target block column number.
For Example, let us suppose we have a multiple block Prices with 4 columns, with column 3 filled with Quantities and Column 4 with Prices, we also have a single block TotalPrices with two fields totalQuantity and TotalPrices, we want these fields to be aligned with the correct columns of the Prices block:</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5) Prices : P "Prices Block"
 BORDER row
...
END BLOCK

BLOCK (1,1) TotalPrices : TP "TotalPrice"
  BORDER row
  ALIGN Prices &lt;1-3, 2-4&gt;
...
END BLOCK</pre></div><div class="section" title="Block Help"><div class="titlepage"><div><div><h4 class="title"><a id="_block_help"></a>Block Help</h4></div></div></div><p>This optional command is used to define the help text for each field of the block. The different texts are to be entered after the word HELP.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5) Degree: D "Degree Block"
  BORDER row
  HELP "The degree the student will target at the end of a year"
  ...
END BLOCK</pre></div><div class="section" title="Block Options"><div class="titlepage"><div><div><h4 class="title"><a id="_block_options"></a>Block Options</h4></div></div></div><p>In this optional section you can insert commands with restriction functions towards the users, the available commands that you can use are :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
NO CHART : Disables the chart(grid) rendering of a multiple bloc to make it look like a single block.Only possible on multiple blocks displaying only one row, Besides the fields must be positioned with the AT command.
</li><li class="listitem">
NO DETAIL : Disables the positioning of fields and displays the block as a chart (grid), Only possible on multiple blocks, the fields should not be positioned with the AT command.
</li><li class="listitem">
NO DELETE :  Prevent the user from removing fields content.
</li><li class="listitem">
NO INSERT :  Prevent the user from inserting data in fields.
</li><li class="listitem">
NO MOVE   :  Prevent the user from moving between records.
</li><li class="listitem">
ACCESS ON SKIPPED : Makes the block accessible even if or its fields have SKIPPED access.
</li><li class="listitem">
UPDATE INDEX : If used, saving a block would delete all its rows and reinsert them one by one, by doing so, you can update the table rows even when you change the index fields without worrying about the "row already exist exception".
</li></ul></div></div><div class="section" title="Block Tables"><div class="titlepage"><div><div><h4 class="title"><a id="_block_tables"></a>Block Tables</h4></div></div></div><p>When making use of this section, you have to type the command TABLE and enter the table name followed by a comma and by the shortcut to this table name. This shortcut will further be used as a shorthand in place of the complete table name in order to access to the table. These names refer to certain tables in the database whereby the first table is the one on which the user will work. The remaining tables are the so-called "look-up tables", i.e tables that are associated with the first one.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">BlockTables:   "TABLE"  "&lt;"SimpleName  , SimpleName &gt; [BlockTables]*</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">TABLE &lt;Lessons,L&gt;
TABLE &lt;Lecturers, P&gt;
TABLE &lt;Rooms, R&gt;</pre><p>The user will make use of these look-up tables as references
when bringing in changes in the principal table.</p></div><div class="section" title="Block Indexes"><div class="titlepage"><div><div><h4 class="title"><a id="_block_indexes"></a>Block Indexes</h4></div></div></div><p>If you plan to enter one index or more when defining your fields, you also have to define one index text or more which will appear if you make a mistake by entering an indexed data or a data combination twice. This command can be followed by an error message contained in a string.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">BlockIndices:   "INDEX" String message  [BlockIndices]*</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK (10,5) Degree : D "Degree"
 BORDER row
 INDEX "This data already exists"
 ...
END BLOCK</pre></div><div class="section" title="Block Commands"><div class="titlepage"><div><div><h4 class="title"><a id="_block_commands"></a>Block Commands</h4></div></div></div><p>Block commands are commands accessible only from the block where they are called. There are Three ways to call block commands:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Calling A Standard Command</strong></span>
</li></ul></div><p>There are 5 possible structures:</p><pre class="screen">"COMMAND" QualifiedName

Example
COMMAND ResetBlock</pre><p>Or:</p><pre class="screen">"COMMAND" "ITEM" SimpleName "CALL" SimpleName "END" "COMMAND"

Example
COMMAND
  ITEM Save
  CALL Save
END COMMAND</pre><p>Or:</p><pre class="screen">"COMMAND" "ITEM" SimpleName "EXTERN" QualifiedName "END" "COMMAND"

Example
COMMAND
  ITEM SharesOfExpenses
  EXTERN Costing
END COMMAND</pre><p>Or:</p><pre class="screen">"COMMAND" "ITEM" SimpleName "ACTION" (VBlock SimpleName) {Kopi-Java Code}
"END" "COMMAND"

Example
COMMAND
  ITEM End
  ACTION (VBlock b) {
    b.validate ();
    close (CDE_VALIDATE)
   }
END COMMAND</pre><p>Or:</p><pre class="screen">"COMMAND" "ITEM" SimpleName "ACTION" {Kopi-Java Code} "END" "COMMAND"

Example
COMMAND
  ITEM Validate
  ACTION {
    validate ();
  }
END COMMAND</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Calling The Block Commands With Modes</strong></span>
</li></ul></div><p>Blocks have 3 possible Modes:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
QUERY  : When querying the database
</li><li class="listitem">
INSERT : When inserting a new row in the database
</li><li class="listitem">
UPDATE : When updating rows in the database
</li></ul></div><p>You can combine these modes with the previous block command structure to have more control over your command</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting"> ON BlockMode SimpleName</pre><p>This means that the command called is only accessible when the block is in the specified Mode.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting"> ON QUERY, UPDATE COMMAND InsertMode</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Calling The Block Commands With Modes And An Access Modifier</strong></span>
</li></ul></div><p>in Kopi, a field can have different access types or modifiers, here is the definition of the four available access modifiers listed by ascending level.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
HIDDEN : HIDDEN field are invisible in the form, they are used to store hidden operations and database joins.
</li><li class="listitem">
SKIPPED : SKIPPED fields are read only fields, you can read the value but you can’t modify it.
</li><li class="listitem">
VISIT : fields with this access type are accessible, can be modified but not necessary.
</li><li class="listitem">
MUSTFILL : MUSTFILL fields are accessible fields that the user must fill with a value.
</li></ul></div><p>In the block command section, you can set the highest access level for the block fields according to the mode in wich the block would beording to the mode in which the block would be.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting"> ON QUERY, UPDATE SKIPPED
 ON UPDATE HIDDEN
 ON QUERY VISIT</pre><p>In the first example, all fields in the block will be either SKIPPED or HIDDEN in the query and update modes and can neither be MUSTFILL nor VISIT.
For the second example, all the fields in the block will be HIDDEN when the block is in update mode.
In the last example, all the fields in the block will be either VISIT, SKIPPED or HIDDEN in the query mode and can not be MUSTFILL.</p></div><div class="section" title="Block Triggers"><div class="titlepage"><div><div><h4 class="title"><a id="_block_triggers"></a>Block Triggers</h4></div></div></div><p>The block triggers are the same as form triggers on the block level. There are actually 20 block triggers you can use to execute actions once they are fired.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting"> BlocTrigger: BlocEventList TriggerAction

 BlocEventList: BlockEvent [,BlockEvent]*</pre><p>Concerning the trigger action, which is the action to execute when the trigger is activated they can by :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
a local function   : SimpleName
</li><li class="listitem">
an external function : EXTERN QualifiedName
</li><li class="listitem">
{KOPI_JAVA code}
</li><li class="listitem">
(VBlock SimpleName){KOPI_JAVA code}
</li></ul></div><p>Here is a list of all available block triggers or block events in Kopi.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
PREQRY  : executed before querying the database
</li><li class="listitem">
POSTQRY : executed after querying the database
</li><li class="listitem">
PREDEL  : executed before a row is deleted
</li><li class="listitem">
POSTDEL : executed after a row is deleted
</li><li class="listitem">
PREINS  : executed before a row is inserted
</li><li class="listitem">
POSTINS : executed after a row is inserted
</li><li class="listitem">
PREUPD  : executed before a row is updated
</li><li class="listitem">
POSTUPD : executed after a row is updated
</li><li class="listitem">
PRESAVE : executed before saving a row
</li><li class="listitem">
PREREC  : executed upon record entry
</li><li class="listitem">
POSTREC : executed upon record exit
</li><li class="listitem">
PREBLK  : executed upon block entry
</li><li class="listitem">
POSTBLK : executed upon block exit
</li><li class="listitem">
VALBLK  : executed upon block validation
</li><li class="listitem">
VALREC  : executed upon record validation
</li><li class="listitem">
DEFAULT : is executed when the block is in the InsertMode. This trigger becomes active when the user presses the key F4. It will then enable the system to load standard values which will be proposed to the user if he wishes to enter new data.
</li><li class="listitem">
INIT    : executed upon block initialization
</li><li class="listitem">
RESET   : executed upon Reset command (ResetForm)
</li><li class="listitem">
CHANGED : a special trigger that returns a boolean value of wether the block have been changed or not, you can use it to bypass the system control for changes this way :
</li></ul></div><pre class="screen"> CHANGED {
   return false;
 }</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
ACCESS  : defines whether a block can or not be accessed, it must always return a boolean value
</li></ul></div><pre class="screen">  ACCESS{
    return Block.getMode == MOD_QUERY
    // Tests if the block is in query mode,
    this block is only accessible on query mode
  }</pre><p><span class="strong"><strong>Examples</strong></span></p><pre class="programlisting">BLOCK (10,5) Degree : D "Degree"
  BORDER row
  INDEX "This data already exists"
  COMMAND ResetForm

  INIT,PREBLK{
   KOPI_JAVA code
  }
  PREINS{
   System.out.print("Inserting date");
   ...
  }
  ...
END BLOCK</pre></div><div class="section" title="Block Fields Declaration"><div class="titlepage"><div><div><h4 class="title"><a id="_block_fields_declaration"></a>Block Fields Declaration</h4></div></div></div><p>In this section, all you have to do is to write at least on block field definition that begins with an access modifier and ends with END FIELD, you can enter as much fields as you may need
following the field definition we saw in the previous chapter.</p></div><div class="section" title="Block Context Footer"><div class="titlepage"><div><div><h4 class="title"><a id="_block_context_footer"></a>Block Context Footer</h4></div></div></div><p>In this section of the block, you can write local functions, define inner classes, override command actions, define your data members.
The elements you write in the block Context Footer are accessible in the concerned block and are written in KOPI_JAVA code.</p></div></div><div class="section" title="2.2.3. Creating Forms"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_forms"></a>2.2.3. Creating Forms</h3></div></div></div><p>There are actually two types of forms in kopi, normal forms and BLOC INSERT forms which are special forms containing blocks that you may insert in other forms.
A form begins always with FORM and ends with END FORM, while a BLOC INSERT form begins with BLOC INSERT and ends with END INSERT. When creating a form, you will have to include the block and the field definitions. Moreover, you will have to define the menus as well as the different commands. Finally, you can also define some form triggers. Concretely, the structure is the following:</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">FormDef : ["LOCALE" String formLocalization]
          "FORM" String formTitle
          ["IS" QualifiedName "IMPLEMENTS" QualifiedName[,QualifiedName]*]
          [FormHeader]  [MenuDefinition]
          [ActorDefinition] [TypeDefinition]
          [CommandDefinition] [InsertDefinition]
          "BEGIN"
          [FormCommands] [FormsTriggers] [BlocksDefinition]
          [ContextFooter]
          "END" "FORM"</pre><div class="section" title="Form Localization"><div class="titlepage"><div><div><h4 class="title"><a id="_form_localization"></a>Form Localization</h4></div></div></div><p>This is an optional step in which you may define the language of your forms menus and messages, the latter have to be defined in xml files.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">"LOCALE" String formLocalization</pre><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">LOCALE "en_EN"</pre></div><div class="section" title="Form Title"><div class="titlepage"><div><div><h4 class="title"><a id="_form_title"></a>Form Title</h4></div></div></div><p>Every form have to begin with the keyword FORM that you can follow with a title (optional).</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">"FORM" String formTitle</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM  "Lecturers List"
  ...
END FORM</pre></div><div class="section" title="Form Superclass And Interfaces"><div class="titlepage"><div><div><h4 class="title"><a id="_form_superclass_and_interfaces"></a>Form Superclass And Interfaces</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Superclass:</strong></span>
</li></ul></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">SuperForm:   "IS" QualifiedName</pre><p>Every form is a class that may extend another Java class by using the optional keyword IS. Otherwise,  Kopi will automatically take over the java.lang.Object QualifiedName.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "Service Register" IS VReportSelectionForm</pre><p>In other words, the class declaration you have just made specifies the direct superclass of the current class.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Interfaces</strong></span>
</li></ul></div><p>You can also specify interfaces which the form may implement by using the IMPLEMENTS option. When used in a form declaration, this option then lists the names of interfaces that are direct superInterfaces of the class being declared. Thus, you will have the following structure:</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">Interface :  "IMPLEMENTS" QualifiedName [,QualifiedName]*</pre><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">FORM "Record registering" IS VPrintSelectionForm
  IMPLEMENTS VConstants
  ...
END FORM</pre></div><div class="section" title="Form Header"><div class="titlepage"><div><div><h4 class="title"><a id="_form_header"></a>Form Header</h4></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ContextHeader:   { PackageDeclaration  ImportDeclarations  }

PackageDeclaration:   &lt;As defined in JLS 7.4&gt;
ImportDeclarations:   &lt;As defined in JLS 7.5&gt;</pre><p>The package definition is contained in the header. It consists in defining where this form belongs to i.e which application, which firm or which person it is related to.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of the Lecturers"
  {
  package at.dms.apps.timetable;
  }
  ...
END FORM</pre><p>In this example, the form belongs to the DMS firm and is a part of the application called "timetable". In addition to this Java package declaration, you can make a Java import declaration in order to import some classes from other packages. You can add an unlimited number of imports.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of the Lecturers"
  {
    package at.dms.apps.tb;
    import java.util.Vector
  }
   ...
END FORM</pre></div><div class="section" title="Menus Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_menus_definition"></a>Menus Definition</h4></div></div></div><p>Defining a menu means adding an entry to the menu bar in the top of the form, you can add actors to this menu later by specifying the menu name in the actor definition. In the menu definition, the LABEL is optional.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">MenuDefinition:   "MENU" SimpleName
                  ["LABEL" String label]
                  "END" "MENU"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of the Lecturers"

  {
    package at.dms.apps.tb;
  }

  MENU File
    LABEL "file"
  END MENU
...
END FORM</pre></div><div class="section" title="Actors Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_actors_definition"></a>Actors Definition</h4></div></div></div><p>An Actor is an item to be linked with a command, if its ICON is specified, it will appear in the icon_toolbar located under the menu bar, otherwise, it will only be accecible from the menu bar.
ICON,LABEL and KEY are optional, the KEY being the keyboard shortcut to assign to the actor.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ActorDefinition:  "ACTOR" SimpleName
                  "MENU"  SimpleName
                  ["LABEL" String label]
                  "HELP"  String helpText
                  ["KEY"   String key]
                  ["ICON"  String icon]
                  "END" "ACTOR"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of the Lecturers"

  {
    package at.dms.apps.tb;
  }

  MENU File
    LABEL "file"
  END MENU


  ACTOR cut
    MENU  File
    LABEL "cut"
    HELP  "cut element"
    ICON        "CutIcon"
  END ACTOR
...
END FORM</pre></div><div class="section" title="Types Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_types_definition"></a>Types Definition</h4></div></div></div><p>After having defined your menus and actor, you can enter different field types definitions based on the standard field types or code field types, you can also use the LIST and SELECT commands
to customize these new types.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="screen">TypeDefinition:  "TYPE" SimplName "IS" FieldType
                 [TypeList]
                 "END" "TYPE"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of the Lecturers"
  {
    package at.dms.apps.tb;
  }
  TYPE Name IS
    STRING (20,10,4)
    CONVERT UPPER
  END TYPE

  TYPE Lesson IS
    LONG (11)
    MINVAL 0
    MAXVAL 100
  END TYPE

  TYPE Answer IS
    CODE BOOL IS
        "Yes"   = TRUE
        "No"  = FALSE
    END CODE
  END TYPE

  TYPE Months IS
    ENUM("January", "February", "March", "April")
  END TYPE

TYPE Lecturer IS
  STRING (8)
  CONVERT UPPER

  LIST "Lecturer" IS
    "Symbol" = Symbol : STRING (8)
    "Name" = Name : STRING (40)
    "Surname" = Surname : STRING (40)
    "Lesson" = Lesson : STRING (20)
  END LIST
...
END TYPE

  ...
END FORM</pre></div><div class="section" title="Commands Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_commands_definition"></a>Commands Definition</h4></div></div></div><p>In this section you may want to define new commands, to do so, all you need is an already defined Actor from which you will call the command in order to execute an Action on the form. There are 3 ways to define this Action:
every command have a effective ray of action (VField, VBlock, VForm)</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Calling a function with the CALL command
</li><li class="listitem">
Calling a function outside of the form using the EXTERN command
</li><li class="listitem">
Simply writing the body of the action using the  ACTION command, the parameters are optional and can be VField, VBlock, VForm.
</li></ul></div><p>Command Defined in this section can be form level commands, block level commands or field level commands, this will depend on the action called by the command and where the command is actualy called.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">cmdDef  : "COMMAND" QualifiedName
          "ITEM" SimpleName commandBody
          "END" "COMMAND"

cmddBody: "CALL" SimpleName | "EXTERN" QualifiedName
     |"ACTION" [(VField SimpleName | VBlock SimpleName | VForm SimpleName)]
           {KOPI_JAVA statements}</pre><p><span class="strong"><strong>Example</strong></span></p><p>Calling a local action :</p><pre class="programlisting">COMMAND Preview
  ITEM  Preview
  CALL  previewForm
END COMMAND</pre><p><span class="strong"><strong>Example</strong></span>
Calling an external action :</p><pre class="programlisting">COMMAND SaveBlock
  ITEM Save
  EXTERN com.company.vlib.form.Commands.SaveBlock
END COMMAND</pre><p><span class="strong"><strong>Example</strong></span>
Writing the action’s body :</p><pre class="programlisting">COMMAND PrintBlock
  ITEM  PrintBlock
  ACTION (VBlock b){
    b.validate();
    b.getForm().close (VForm.CDE-Validate);
  }
END COMMAND</pre></div><div class="section" title="Insert Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_insert_definition"></a>Insert Definition</h4></div></div></div><p>This command allows you to actually define your types, menus, actors, commands in another file, and then insert it in any form you want, thus avoiding rewriting recurrent definitions. You still can add definition before or after using the INSERT command.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">Insert Definition : "INSERT" String filePath</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of Students"

  {
  package at.dms.app.application
  }

  INSERT "Global.vf"

  TYPE Lesson IS
    LONG(11)
  END TYPE

...
END FORM</pre><p>After the different definitions we have made (types, menus, actors,commands), we need to begin the declaration of our form.Here, we will set up the structure and the behaviour of the form throw 4 sections :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Form Options
</li><li class="listitem">
Form Commands
</li><li class="listitem">
Form Triggers
</li><li class="listitem">
Blocks
</li></ul></div></div><div class="section" title="Form Commands Declaration"><div class="titlepage"><div><div><h4 class="title"><a id="_form_commands_declaration"></a>Form Commands Declaration</h4></div></div></div><p>In this section you may call the commands you want your form to have.You can call commands you already defined in the command definition section :</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BEGIN

  COMMAND Preview
  COMMAND PrintBlock</pre><p>You can also make use of Kopi’s ready command such as :</p><pre class="screen">BEGIN

  COMMAND HelpForm
  COMMAND QuitForm</pre><p>Moreover, you can define your command in this section the same way you did in the command definition section, but with no command name, it will be both a definition and a declaration.</p><p>There still one more think to know about form command declaration, in fact, you can also control the accessibility to a command by the Mode of the form.+
A form have 3 possible Modes :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
QUERY  : When inquiring the database
</li><li class="listitem">
INSERT : When inserting a row in the database
</li><li class="listitem">
UPDATE : When updating a row in the database
</li></ul></div><p>The Syntax to use command with modes is the following :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="screen">"ON" ModeName [,ModeName]* "COMMAND" SimpleName</pre></div><div class="section" title="Form Triggers Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_form_triggers_definition"></a>Form Triggers Definition</h4></div></div></div><p>Form Triggers are special events that once switched on you can execute a set of actions defined by the following syntax :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="screen">FormTrigger  :    FormEventList TriggerAction
FormEventList:  FormEvent [,FormEvent]*</pre><p>Kopi actually defines 6 Form Triggers or Form Events :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
INIT      : executed when initializing the form and before the PREFORM Trigger, also executed at ResetForm command
</li><li class="listitem">
PREFORM   : executed before the form is displayed and after the INIT Trigger, not executed at ResetForm command
</li><li class="listitem">
POSTFORM  : executed when closing the form
</li><li class="listitem">
QUITFORM  : actually not available
</li><li class="listitem">
RESET     : executed upon ResetForm command
</li><li class="listitem">
CHANGED   : a special trigger that returns a boolean value of whether the form have been changed or not, you can use it to bypass the system control for changes this way :
</li></ul></div><pre class="screen"> CHANGED {
   return false;
 }</pre><p><span class="strong"><strong>Examples</strong></span></p><pre class="screen">INIT{
  System.out.println("Trigger INIT activated");
  // KOPI_JAVA statements
}

INIT,PREFORM{
  //KOPI_JAVA statements
}</pre></div><div class="section" title="Form Pages"><div class="titlepage"><div><div><h4 class="title"><a id="_form_pages"></a>Form Pages</h4></div></div></div><p>You can create Pages in your form using the NEW PAGE command after the trigger declaration section,this is optional and will create a Tab for each page you create under the form’s toolbar.
You can put as much blocks you want in each page, the same goes for form without pages.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="screen"> NEW PAGE "Page1"</pre></div><div class="section" title="Form Blocks"><div class="titlepage"><div><div><h4 class="title"><a id="_form_blocks"></a>Form Blocks</h4></div></div></div><p>You can have several blocks in one form, you just have to stack them in your form, using the definition presented in the Second chapter of this document, after the form triggers definition, you can also group them in pages.</p><p>You can also use the block import command in order to import block units (predefined blocks) in your form :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="screen">BlockImport: "INSERT" QualifiedName</pre><p>As for the Block Unit definition, you can create one by creating a new form file using with this Syntax:</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">BlockUnit: "BLOCK" "INSERT" ContextHeader
          [MenuDefinition]
          [ActorDefinition] [TypeDefinition]
          [CommandDefinition] [InsertDefinition] BlockDeclaration
          "END" "INSERT"</pre><p>You can see that a Block Unit has the same structure of a normal Form, with the absence of the form declaration Section, replaced by a Block Declaration Section. Moreover, a Block Unit does not have a Context Footer.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">BLOCK INSERT
{
  package at.dms.apps.tb;
}

//Here you can add Types, commands, actors definitions

  INSERT "Global.vf"

  BLOCK (10, 5) Lecturer.L "Lecturers"
    BORDER LINE
    ALIGN Name&lt;1-3&gt;
    TABLE &lt;Lecturers, L&gt;
    TABLE &lt;Lessons, C&gt;

      VISIT lecturers
        LABEL
        STRING(10)
        COLUMNS(L.lecturers)
      END FIELD


      VISIT lessons
        LABEL
        STRING(10)
        COLUMNS(C.lessons)
      END FIELD

  END BLOCK
...

END INSERT</pre></div></div><div class="section" title="2.2.4. Form Context Footer"><div class="titlepage"><div><div><h3 class="title"><a id="_form_context_footer"></a>2.2.4. Form Context Footer</h3></div></div></div><p>In this section of the form, you can write your local functions, define inner classes, override command actions, define your data members.
The elements you write in the forms Context Footer are accessible in all the form and are writen in KOPI_JAVA code.</p></div></div><div class="section" title="2.3. Visual Kopi Reports"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_visual_kopi_reports"></a>2.3. Visual Kopi Reports</h2></div></div></div><p>Visual Kopi allows you to create dynamic reports. These are  files with the ".vr" extension that have a very simple structure, in fact, all you have to do to create such reports
is to list the definitions of all the fields you need, then you will have to write a constructor that will load data into these fields.
The so created reports will have dynamic functions such as sorting and group making, you will also be able to print it or export to different file formats.You can even add other fields
to the report after it’s generated, do more calculus, customize the report columns…
The Visual Kopi Reports are generated from Visual Kopi form files with the ".vf" extension by different methods that we will see in this chapter, along with the process of making a
dynamic report.</p><div class="section" title="2.3.1. Creating Report Fields"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_report_fields"></a>2.3.1. Creating Report Fields</h3></div></div></div><p>As we said in the introduction, the report structure is based on report fields, these fields begin with FIELD  and a SimpleName and ends with END FIELD and have the following syntax :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">ReportFieldDef: "FIELD" [Integer MultiField] SimpleName [FieldLabel]
                [HelpText] FieldType [FieldAlign] [FieldOptions]
                [GroupCommand] [FieldCommands] [FieldTriggers]
                "END" "FIELD"
GroupCommands : "GROUP" SimpleName</pre><div class="section" title="Single Field and Multiple Fields"><div class="titlepage"><div><div><h4 class="title"><a id="_single_field_and_multiple_fields"></a>Single Field and Multiple Fields</h4></div></div></div><p>When you define a news report field, you have the choice to make it multiple by adding an integer (i) just after the FIELD command, doing so will create i fields.
The generated fields will have the SimpleName indicated after the FIELD command plus a number from 1 to i.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD(3) Name
  ...
END FIELD</pre><p>In this example we have created 3 fields (Name1, Name2 and Name3).</p></div><div class="section" title="Report Field Label"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_label"></a>Report Field Label</h4></div></div></div><p>The field label is the name that will be shown in the dynamic report, you can define a label by entering the LABEL command followed by String separated with a comma. If you omit the Strings after the LABEL command, the field
will have its SimpleName as label. You can also specify NO LABEL if you want your field to have no label at all.
If you specify more than one String after the LABEL command, then if your field is Single it will have the first String as label, otherwise, if it’s a multiple field each generated field will have a label
from the Strings by order.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Name
  LABEL "Person Name"
  ...
END FIELD


FIELD(3) LastName
  LABEL "Name1", "Name2", "Name3"
  ...
END FIELD


FIELD Age
  LABEL
  ...
END FIELD


FIELD ID
  NO LABEL
  ...
END FIELD</pre></div><div class="section" title="Report Field Help Text"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_help_text"></a>Report Field Help Text</h4></div></div></div><p>HELP is used to insert an explanation text for the application user . This Help text will then be displayed when the user places the mouse on the report field.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Name
  LABEL
  HELP *"The Person's First Name"
  ...
END FIELD</pre></div><div class="section" title="Report Field Type"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_type"></a>Report Field Type</h4></div></div></div><p>The field type is a required entry, you may enter a predefined field type :</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Name
  LABEL
  STRING(10)
END FIELD


FIELD Age
  LONG(3)
END FIELD</pre><p>You can also use self defined field types that you have previously defined in the type definition section of your report.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD objectList
  LABEL
  TYPE Objects
END FIELD</pre><p>In this example, Objects is a type you should have defined previously in type definition section of the report using standard types, CODE types, ENUM types, LIST and SELECT command …</p></div><div class="section" title="Report Field Alignment"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_alignment"></a>Report Field Alignment</h4></div></div></div><p>This command is used to define the localization of the field’s content inside the field. There are three types of alignment.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
ALIGN RIGHT the value is displayed at the right inside the field
</li><li class="listitem">
ALIGN LEFT the value is displayed at the left inside the field
</li><li class="listitem">
ALIGN CENTER the value is centered in the field
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Name
  LABEL
  STRING(10)
  ALIGN CENTER
END FIELD</pre></div><div class="section" title="Report Field Options"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_options"></a>Report Field Options</h4></div></div></div><p>There is actually only one option for the dynamic report fields in Kopi: the HIDDEN OPTION , if this option is used on a field, he will not be visible the the report.
This options have to be used on the last visible field of the report to avoid rendering bugs.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Name
  LABEL
  STRING(10)
  HIDDEN
END FIELD</pre><p>The field Name will not be visible on the report.</p></div><div class="section" title="Report Field Group"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_group"></a>Report Field Group</h4></div></div></div><p>You can create clickable groups in your report by using the keyword GROUP in you field followed by the field you want to be grouped by the actual field.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Customers
  LABEL
  STRING(5)
END FIELD

FIELD Articles
  LABEL
  STRING(10)
END FIELD

FIELD InvoiceNum
  LABEL
  STRING(10)
  GROUP Articles
  GROUP Customers
END FIELD</pre><p>In this report, you can click on the InvoiceNum field to group customers and articles.</p></div><div class="section" title="Report Field Command"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_command"></a>Report Field Command</h4></div></div></div><p>In report Fields, you can call commands with one of the following syntaxes :</p><pre class="programlisting">"COMMAND" QualifiedName

Example
COMMAND ExportCsv</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "CALL" SimpleName "END" "COMMAND"

Example
COMMAND
  ITEM Export
  CALL function
END COMMAND</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "EXTERN" QualifiedName "END" "COMMAND"

Example
COMMAND
  ITEM Export
  EXTERN function
END COMMAND</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "ACTION"
(VReportColulmn SimpleName) {Kopi-Java Code}
"END" "COMMAND"</pre><p>Or:</p><pre class="programlisting">"COMMAND" "ITEM" SimpleName "ACTION" {Kopi-Java Code}
"END" "COMMAND"</pre></div><div class="section" title="Report Field Triggers"><div class="titlepage"><div><div><h4 class="title"><a id="_report_field_triggers"></a>Report Field Triggers</h4></div></div></div><p>Report field triggers are special events that you can catch to execute other actions.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">Trigger      : EventList TrigerAction

EventList    : Event [,EventList]*

TrigerAction : SimpleName | "EXTERN" QualifiedName | {KOPI_JAVA code} |
               (VReportColulmn SimpleNAme){KOPI_JAVA code}</pre><p>Here is the two triggers available for report fields :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
FORMAT  : Actually not available
</li><li class="listitem">
COMPUTE : executed when the report is displayed and can be used to compute expressions on the report columns and show the result.
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FIELD Price
  LABEL
  FIXNUM(9, 4)
  COMPUTE  EXTERN ReportTriggers.sumFixed
END FIELD

FIELD
  LABEL
  STRING(10)
  FORMAT
END FIELD</pre></div></div><div class="section" title="2.3.2. Creating Reports"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_reports"></a>2.3.2. Creating Reports</h3></div></div></div><p>Visual Kopi Dynamic reports have a unique structure that begin with REPORT and ends with END REPORT as described by the following syntax :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">ReportDefinition  :[ReportLocalization] "REPORT" ReportTitle
                   [IS QualifiedName] 
                   ["IMPLEMENTS"  [,QualifiedName]*]
                   [ContextHeader] [ReportHelp] [ReportDefinitions]
                   "BEGIN" [ReportCommands] [ReportTriggers] (ReportFields)
                   [ContextFooter]
                   "END" "FIELD"

ReportTitle       :  String Title

ReportDefinitions : [MenuDefinition] [ActorDefinition] [TypeDefinition]
                    [CommandDefinition]
                    [InsertDefinition]</pre><div class="section" title="Report Localization"><div class="titlepage"><div><div><h4 class="title"><a id="_report_localization"></a>Report Localization</h4></div></div></div><p>This is an optional step in which you may define the language of your forms menus and messages, the latter have to be defined in xml files.</p><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">LOCALE "en_EN"</pre></div><div class="section" title="Report Title"><div class="titlepage"><div><div><h4 class="title"><a id="_report_title"></a>Report Title</h4></div></div></div><p>Every Report have to begin with the keyword REPORT that you have to follow with a title.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "Invoices"
  ...
END REPORT</pre></div><div class="section" title="Report Superclass And Interfaces"><div class="titlepage"><div><div><h4 class="title"><a id="_report_superclass_and_interfaces"></a>Report Superclass And Interfaces</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Superclass:</strong></span>
</li></ul></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">SuperClass:   "IS" QualifiedName</pre><p>Every Report is a class that may extend another Java class by using the optional keyword IS. Otherwise,  Kopi will automatically take over the java.lang.Object QualifiedName.</p><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">REPORT  "Orders Report" IS VReport</pre><p>In other words, the class declaration you have just made specifies the direct superclass of the current class.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Interfaces:</strong></span>
</li></ul></div><p>You can also specify interfaces which the report may implement by using the IMPLEMENTS option.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">"IMPLEMENTS" QualifiedName [,QualifiedName]*</pre><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">REPORT "Orders Report" IS VReport
  IMPLEMENTS UReport
  ...
END REPORT</pre></div><div class="section" title="Report Header"><div class="titlepage"><div><div><h4 class="title"><a id="_report_header"></a>Report Header</h4></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ContextHeader:   { PackageDeclaration  ImportDeclarations  }

PackageDeclaration:   &lt;As defined in JLS 7.4&gt;
ImportDeclarations:   &lt;As defined in JLS 7.5&gt;</pre><p>The package definition is contained in the header. It consists in defining where this report belongs to i.e which application, which firm or which person it is related to.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "List of the Lecturers"
  {
  package at.dms.apps.timetable;
  }
  ...
END REPORT</pre><p>In this example, the report belongs to the DMS firm and is a part of the application called "timetable". In addition to this Java package declaration, you can make a Java import declaration in order to import some classes from other packages. You can add an unlimited number of imports.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "List of the Lecturers"
  {
    package at.dms.apps.tb;

    import java.util.Hashtable
    import java.util.Vector
  }
   ...
END REPORT</pre></div><div class="section" title="Report Help Text"><div class="titlepage"><div><div><h4 class="title"><a id="_report_help_text"></a>Report Help Text</h4></div></div></div><p>After the report header, you can enter a help text for the report using the following syntax:</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">HELP String helpText</pre><p>Actually every report has a help menu that tries to describe the structure of the report by giving information about its commands and fields in a document, the help text will be on the top of this help menu document.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "Orders Report"

  {
    package at.dms.apps.tb;

    import java.util.Hashtable
    import java.util.Vector
  }

HELP "This report lists purchase orders"
...

END REPORT</pre></div><div class="section" title="Report Menus Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_report_menus_definition"></a>Report Menus Definition</h4></div></div></div><p>Defining a menu means adding an entry to the menu bar in the top of the report, you can add actors to this menu later by specifying the menu name in the actor definition. In the menu definition, the LABEL is optional.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">MenuDefinition:   "MENU" SimpleName ["LABEL" String label]   "END" "MENU"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "List of the Lecturers"

  {
    package at.dms.apps.tb;
  }

  MENU newMenu
    LABEL "newMenu"
  END MENU
...
END REPORT</pre></div><div class="section" title="Report Actors Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_report_actors_definition"></a>Report Actors Definition</h4></div></div></div><p>An Actor is an item to be linked with a command, if its ICON is specified, it will appear in the icon_toolbar located under the menu bar, otherwise, it will only be accessible from the menu bar.
ICON,LABEL and KEY are optional, the KEY being the keyboard shortcut to assign to the actor.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ActorDefinition:  "ACTOR" SimpleName
                  "MENU"  SimpleName
                  ["LABEL" String label]
                  "HELP"  String helpText
                  ["KEY"   String key]
                  ["ICON"  String icon]
                  "END" "ACTOR"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM "List of the Lecturers"

  {
    package at.dms.apps.tb;
  }

  MENU newMenu
    LABEL "newMenu"
  END MENU


  ACTOR printReport
    MENU  newMenu
    LABEL "Print"
    HELP  "Print the report"
    ICON  "printerIcon"
  END ACTOR
...
END REPORT</pre></div><div class="section" title="Report Types Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_report_types_definition"></a>Report Types Definition</h4></div></div></div><p>After having defined your menus and actor, you can enter different field types definitions based on the standard field types or code field types, you can also use the LIST and SELECT commands
to customize these new types.</p><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="screen">TypeDefinition:  "TYPE" SimplName "IS" FieldType  [TypeList] "END" "TYPE"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "List of the Lecturers"
  {
    package at.dms.apps.tb;
  }
  TYPE Name IS
    STRING (20,10,4)
    CONVERT UPPER
  END TYPE

  TYPE Lesson IS
    LONG (11)
    MINVAL 0
    MAXVAL 100
  END TYPE

  TYPE Answer IS
    CODE BOOL IS
        "Yes"   = TRUE
        "No"  = FALSE
    END CODE
  END TYPE

  TYPE Months IS
    ENUM("January", "February", "March", "April")
  END TYPE

TYPE Lecturer IS
  STRING (8)
  CONVERT UPPER

  LIST "Lecturer" IS
    "Symbol" = Symbol : STRING (8)
    "Name" = Name : STRING (40)
    "Surname" = Surname : STRING (40)
    "Lesson" = Lesson : STRING (20)
  END LIST
...
END TYPE

  ...
END REPORT</pre></div><div class="section" title="Report Commands Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_report_commands_definition"></a>Report Commands Definition</h4></div></div></div><p>In this section you may want to define new commands, to do so, all you need is an already defined Actor from which you will call the command in order to execute an Action on the form. There are 3 ways to define this Action:
every command have an effective ray of action (VRField, VReport)</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Calling a function with the CALL command
</li><li class="listitem">
Calling a function outside of the report using the EXTERN command
</li><li class="listitem">
Simply writing the body of the action using the  ACTION command, the parameters are optional and can be VRField or VReport.
</li></ul></div><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">cmdDef: "COMMAND" QualifiedName
        "ITEM" SimpleName
        commandBody
        "END" "COMMAND"

cmdBody: "CALL" SimpleName | "EXTERN" QualifiedName
         |"ACTION"
         [(VField SimpleName | VBlock SimpleName | VForm SimpleName)]
         {KOPI_JAVA statements}</pre><p><span class="strong"><strong>Example</strong></span></p><p>Calling a local action :</p><pre class="programlisting">COMMAND print
  ITEM  printActor
  CALL  printReport
END COMMAND</pre><p><span class="strong"><strong>Example</strong></span>
Calling an external action :</p><pre class="programlisting">COMMAND doAction
  ITEM Save
  EXTERN com.company.vkopi.lib.report.Actions
END COMMAND</pre><p><span class="strong"><strong>Example</strong></span>
Writing the action’s body :</p><pre class="programlisting">COMMAND PrintReport
  ITEM  PrintReport
  ACTION (VReport report){
    // KOPI_JAVA code
  }
END COMMAND</pre></div><div class="section" title="Report Insert Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_report_insert_definition"></a>Report Insert Definition</h4></div></div></div><p>This command allows you to actually define your types, menus, actors, commands in another file, and then insert it in any report you want, thus avoiding rewriting recurrent definitions. You still can add definition before or after using the INSERT command.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">Insert Definition : "INSERT" String filePath</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "List of Students"

  {
  package at.dms.app.application
  }

  INSERT "ReportDefault.vr"

  TYPE Lesson IS
    LONG(11)
  END TYPE

...
END REPORT</pre></div><div class="section" title="Report Commands Declaration"><div class="titlepage"><div><div><h4 class="title"><a id="_report_commands_declaration"></a>Report Commands Declaration</h4></div></div></div><p>After the Definitions section of the report, you have to enter the BEGIN keyword in order to begin the report declaration part where you can optionally call report commands and triggers, and where you have to enter the report’s fields.
Concerning the commands declaration, you can start by the REPORT COMMAND statement that add all the default report commands to your report that include printing and exporting the report.
Now you may call other commands using the COMMAND keyword followed by a defined command name from those who already exist or the ones you defined in the command definition section.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">COMMAND Sort
COMMAND PrintReport</pre><p>You can also define your command when declaring it instead of defining it in the command definition section of the report, simply write the command definition like explained before, but with no name, in the command declaration section of the report.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">COMMAND
  ITEM actorName
  ACTION {
    KOPI_JAVA code
  }
END COMMAND


COMMAND
  ITEM actorName
  CALL localFunction
END COMMAND</pre></div><div class="section" title="Report Triggers Declaration"><div class="titlepage"><div><div><h4 class="title"><a id="_report_triggers_declaration"></a>Report Triggers Declaration</h4></div></div></div><p>Report Triggers are special events that once switched on you can execute a set of actions defined by the following syntax :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="screen">ReportTrigger  :    ReportEventList TriggerAction
ReportEventList:  ReportEvent [,FormEvent]*</pre><p>Kopi actually defines 2 report Triggers or report Events :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
PREREPORT  : executed before the report is displayed.
</li><li class="listitem">
POSTREPORT : executed after the report is closed.
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">REPORT "Orders Report"
{

  package at.dms.app.application
}

INSERT "ReportDefault.vr"

BEGIN

  REPORT COMMAND

  PREREPORT{
    System.out.println("This message is displayed before the report appears");
  }
  ...
END REPORT</pre></div><div class="section" title="Report Fields Declaration"><div class="titlepage"><div><div><h4 class="title"><a id="_report_fields_declaration"></a>Report Fields Declaration</h4></div></div></div><p>As you already know, a dynamic report is based on field that will be shown as report columns, in this section you have to write at least on field definition or more following
the definition and the structure we saw in the previous chapter.</p></div><div class="section" title="Report Context Footer:"><div class="titlepage"><div><div><h4 class="title"><a id="_report_context_footer"></a>Report Context Footer:</h4></div></div></div><p>This section should follow the report fields declaration and have to be placed between curly braces, here you may define all the functions, data, classes you need in your report, written in KOPI_JAVA code.
But most important, you need to define the constructor of you report, this constructor will be responsible of filling the report’s lines or rows.
All you need to do is importing your data (a List or vector parameter, database query cursors …) , declaring a row in the report then add the Add(); statement to add the row to the report.
The constructor may have different parameters but a DBContextHandler object is compulsory (a form most of the time)
For example here is the constructor of a dynamic report named UserList with 3 fields (FirstName, LastName, Age).We will retrieve data from the User table on the database.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">void UserList(DBContextHandler context) throws VException {
  super(context);
  #protected () {
    try {
      #cursor (){
        SELECT int U.age,
               String U.firstname,
               String U.lastname,

        FROM    User U

      } cursor;

      cursor.open();

      while (cursor.next())
      {
        FirstName = cursor.U.firstname;
        LastName  = cursor.U.lastname;
        Age       = cursor.U.age;
        add();
      }
      cursor.close();
   } catch (DBNoRowException) {
        System.out.println("DBNoRowException");
      }
  }
}</pre></div></div><div class="section" title="2.3.3. Calling reports"><div class="titlepage"><div><div><h3 class="title"><a id="_calling_reports"></a>2.3.3. Calling reports</h3></div></div></div><p>A report is always called from a form, if the caller form extends from the VDictionaryForm class you have to do the following steps :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Change VDictionaryForm to VReportSelectionForm
</li><li class="listitem">
Add the CreateReport command to the caller form
</li><li class="listitem">
Implement the createReport abstract method :
</li></ul></div><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting"> protected VReport createReport() throws VException{
   return new USerList(this);
 }</pre><p>Otherwise you can create a normal form or block command that executes the following code :</p><pre class="programlisting">   WindowController.getWindowController().doNotModal(new UserList(this));</pre></div></div><div class="section" title="2.4. Visual Kopi Print Pages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_visual_kopi_print_pages"></a>2.4. Visual Kopi Print Pages</h2></div></div></div><p>Visual Prints are static reports that you can create with the Kopi framework, such reports are written in files with the (.vp) extension and have a lot of differences from the dynamic reports we have seen earlier.
In fact, prints are more complicated to create since you have to take care of the design, the positions and the style details of the report.
The result is what we call a static report that you cannot modify or interact with in the PDF format, but you can print, save send ..
 We also call these printable Pages.</p><div class="section" title="2.4.1. Print Page Structure"><div class="titlepage"><div><div><h3 class="title"><a id="_print_page_structure"></a>2.4.1. Print Page Structure</h3></div></div></div><p>When writing a static report, you have to define the data structures, then you insert the data in the report using the defined structures, finally you need to write the print constructor.
A print always begins with PAGE and ends with END PAGE.
Here is the global syntax of a page :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">PageDefinition :  "PAGE" "IS" QualfiedName
                  "IMPLEMENTS" QualifiedName[,QualifiedName]* ]
                  {
                    PackageDeclaration;
                    [ImportDeclaration];
                  }
                  [InsertDefinition]
                  StylesDefinition
                  "BEGIN"
                  PageFormat
                  PageBlocks
                  [PageHeaderFooter]
                  [ContextFooter]
                  "END" "PAGE"</pre><div class="section" title="Page Superclass And Interfaces"><div class="titlepage"><div><div><h4 class="title"><a id="_page_superclass_and_interfaces"></a>Page Superclass And Interfaces</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Superclass:</strong></span>
</li></ul></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">SuperPage:   "IS" QualifiedName</pre><p>Every Page is a class that may extend another Java class by using the optional keyword IS. Otherwise,  Kopi will automatically take over the java.lang.Object QualifiedName.</p><p><span class="strong"><strong>Example:</strong></span></p><pre class="programlisting">PAGE IS PProtectedPage</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Interfaces</strong></span>
</li></ul></div><p>You can also specify interfaces which the Page may implement by using the IMPLEMENTS option.
<span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">"IMPLEMENTS" QualifiedName[,QualifiedName]*</pre></div><div class="section" title="Page Header"><div class="titlepage"><div><div><h4 class="title"><a id="_page_header"></a>Page Header</h4></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="programlisting">ContextHeader:   { PackageDeclaration  ImportDeclarations  }

PackageDeclaration:   &lt;As defined in JLS 7.4&gt;
ImportDeclarations:   &lt;As defined in JLS 7.5&gt;</pre><p>The package definition is contained in the header. It consists in defining where this Page belongs to i.e which application, which firm or which person it is related to.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">PAGE IS PProtectedPage
  {
  package at.dms.apps.timetable;

  import java.util.Hashtable
  import java.util.Vector
  }
  ...
END PAGE</pre><p>In this example, the Page belongs to the DMS firm and is a part of the application called "timetable". In addition to this Java package declaration, you can make a Java import declaration in order to import some classes from other packages. You can add an unlimited number of imports.</p></div><div class="section" title="Insert Definitions"><div class="titlepage"><div><div><h4 class="title"><a id="_insert_definitions"></a>Insert Definitions</h4></div></div></div><p>You can user other files to write your print pages styles and then have them inserted in your print page definition file (.vp) using the INSERT command.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">INSERT "PrintDefault.vp"</pre></div><div class="section" title="Styles Definitions"><div class="titlepage"><div><div><h4 class="title"><a id="_styles_definitions"></a>Styles Definitions</h4></div></div></div><p>In this part of the Page, you have to define the structures and the styles of your page, you can use the following 3 types of styles to define as much structures as you need.</p><p>The Style types are :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
BLOCK STYLES
</li><li class="listitem">
TEXT STYLES
</li><li class="listitem">
PARAGRAPH STYLES
</li><li class="listitem">
<span class="strong"><strong>Block Styles</strong></span>
</li></ul></div><p>Block styles are simple structures that only have Border and Background parameters to set :
<span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">BlockStyle : "BLOCK" "STYLE" SimpleName ["IS" SimpleName]
             ["BORDER" Integer border
             |
             "BACKGROUND" Integer r Integer g Integer b]*
             "END" "STYLE"</pre><p>the BORDER statement sets the thickness of the block’s border, while the BACKGROUND sets the color of the block’s background by setting the RGB color parameters.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">    BLOCK STYLE whiteBlock
        BORDER 5
    END STYLE</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Text Styles</strong></span>
</li></ul></div><p>Text styles are structures that set text data properties :
<span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">TextStyle  : "TEXT" "STYLE" SimpleName ["IS" SimpleName]
             ["BACKGROUND" Integer r Integer g Integer b
             |
             "FOREGROUND" Integer r Integer g Integer b
             |
             "BOLD"
             |
             "ITALIC"
             |
             "SUBSCRIPT"
             |
             "SUPERSCRIPT"
             |
             "UNDERLINE"
             |
             "FONT" String font
             |
             "SIZE" Integer size
             |
             "STRIKETHROUGH"]*

             "END" ""STYLE</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">TEXT STYLE text
  BOLD
  SIZE 22
  FONT "Courier"
  UNDERLINE
END STYLE</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Paragraph Styles</strong></span>
</li></ul></div><p>Paragraph styles are structures for table columns like data entries with :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">ParagraphStyle : "PARAGRAPH" "STYLE" SimpleName ["IS" SimpleName]
                 ["ALIGN" PositionAlign
                  |
                 "IDENT" PositionIdent
                  |
                 "FIRST" "LINE" "IDENT" Integer firstlineIdent
                  |
                 "LINE" "SPACING" Fixed spaces
                  |
                 "ORIENTATION"
                  |
                 "SPACE" PositionSpace
                  |
                 "MARGIN" PositionMargin
                  |
                 "BORDER" Integer border  [TOP | BOTTOM | LEFT | RIGHT]*
                  |
                 "BACKGROUND" Integer r Integer g Integer b
                  |
                 "NO BACKGROUND"
                  |
                 TABSET PrintTabset]*

                 "END" "STYLE"



PositionAlign  : "LEFT"  | "RIGHT"  | "CENTER"  | "JUSTIFIED"
PositionIdent  : "LEFT" Integer left   |  "RIGHT" Integer right
PositionMargin : "LEFT" Integer left   |  "RIGHT" Integer right
PositionSpace  : "ABOVE" Integer above | "BELOW" Integer below
PrintTabset    : (["TAB"] SimpleName "AT" Integer pos "ALIGN" alg)*
alg            : LEFT | CENTER | RIGHT | DECIMAL</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">PARAGRAPH STYLE table
  ALIGN LEFT
  INDENT LEFT 5
  TABSET
    Article AT 10 ALIGN LEFT
    Quantity AT 140 ALIGN RIGHT
    Price AT 260 ALIGN RIGHT
    Discount AT 360 ALIGN RIGHT
    Total AT 490 ALIGN RIGHT
  BORDER 3 TOP
END STYLE


PARAGRAPH STYLE total IS posTabs
  BORDER 5
  BACKGROUND 200 190 210
END STYLE</pre></div><div class="section" title="Page Format Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_page_format_definition"></a>Page Format Definition</h4></div></div></div><p>This section is optional, here you can define the page format :</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">FormatDefinition : [  "LANDSCAPE" | "PORTRAIT"  [String formatValue]   ]

formatValue      : (Integer width  Integer height  Integer border )
                   | A5 | A4 | A3 | legal | letter</pre><p>All you have to do is to insert the keyword that sets the orientation of the page (PORTRAIT or LANDSCAPE), this keyword can be followed by a string that defines the format of the page.
This String can be one of the defined Strings (A5,A4,A3,letter,legal) or you can define the width, the height and the border of the page in a string with the 3 parameters in the mentioned order.
If you don’t define this section, the default values will be PORTRAIT "A4"</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">PORTRAIT "A4"

LANDSCAPE "A5"

PORTRAIT "letter"

PORTRAIT "592 842 25"</pre></div><div class="section" title="Page Blocks Definition"><div class="titlepage"><div><div><h4 class="title"><a id="_page_blocks_definition"></a>Page Blocks Definition</h4></div></div></div><p>This section of the page is where you will insert your data in the form of blocks that can inherit the styles you have defined in the styles definition section of the page.
There are 5 types of blocks you can use to insert you data:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Text Blocks
</li><li class="listitem">
Recursive Blocks
</li><li class="listitem">
Horizontal Blocks
</li><li class="listitem">
List Blocks
</li><li class="listitem">
Rectangle Blocks
</li></ul></div><p>There is also another method that consist on inserting already defined Blocks with the INSERT command.
Before explaining every block type, there are some common properties that are used in most of these blocks which are :</p><p><span class="strong"><strong>BlockPosition</strong></span></p><pre class="programlisting">BlockPosition   : [ "POS" Integer posx (Integer posy | "BELOW")]
                  [ "SIZE" (Integer width | String WidthString)
                   (Integer height| String HeightString) ]
                  [ "SHOW" "IF" KOPI_JAVA code]

WidthString     : "PAGE_WIDTH"  | "MAX"
HeightString    : "PAGE_HEIGHT" | "MAX"</pre><p>The block position property sets the block’s position by specifying the x and y Integer values, the y value can be replaced by the keyword "BELOW" and the text will be placed in the first available position in the y axis.
You can also specify the size of the text block using the SIZE command followed by the width and the height integers, there are also special String values that you can use for the size,
the MAX String can be used for the width or the height, it is equal to 1000.
Width also can be PAGE_WIDTH and height can be PAGE_HEIGHT.
After the size definition you can enter a display condition with the command SHOW IF followed by a condition statement, for example SHOW IF getCurrentPage() == 1; means that the text will be displayed only on the first page.</p><p><span class="strong"><strong>BlockTriggers</strong></span></p><pre class="programlisting">PrintTriggers       : SimpleName [(ParameterList)] { TrigSource }

TrigSource          : [String line | &lt;TAB StyleName&gt; | &lt;StyleName&gt;
                      | "PAGE_COUNT" | (KOPI_JAVA code)
                      | {( (KOPI_JAVA code) =&gt; (TrigSource)* }]*</pre><p>To insert the data into the block, you need to create what we call print triggers, a kind of method that defines the way you fill your block.
These triggers can optionally have a parameter list like any JAVA method and must have a body that can contain various elements:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Simple String texts
</li><li class="listitem">
Styles : to use a style all you need to do is to insert it between "&lt;" and "&gt;", if the style has a TABSET , you have to insert TAB before the name of its elements.
</li><li class="listitem">
Kopi_Java code between parentheses
</li><li class="listitem">
kopi_java condition between parentheses followed by "⇒" then one or more trigger, all this statement shave to be inserted into "{}" and means that the the condition have to be fulfilled in order to activate the trigger placed after the "⇒".
</li></ul></div><p><span class="strong"><strong>BlockBody</strong></span></p><pre class="programlisting">BlockBody  : "BODY" { KOPI_JAVA code }</pre><p>After the triggers, you can have a body block that have to implement the print() abstract method in kopi_java code in which you can use the triggers defined in the same block, it is optional in a text block but you will have to implement it in some of the other blocks like the recursive block.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Text Blocks Definition</strong></span>
</li></ul></div><p>Text blocks are data blocks that can be used to show simple text on the print page :
<span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">TextBlockDefinition : ["REC"] "TEXT" SimpleName
                      BlockPosition
                      ["STYLE" SimpleName]
                      (PrintTriggers)*
                      [BlockBody]
                      "END" "BLOCK"</pre><p>A text Block begins by "TEXT" and ends by "END BLOCK", it can have the optional keyword "REC" before "TEXT" to make the text block recurrent.</p><p><span class="strong"><strong>Example</strong></span>
Using only block triggers :</p><pre class="programlisting">REC TEXT Invoice
  POS 60 160
  SIZE 290 MAX
  SOURCE {
    &lt;alignLeft&gt;&lt;helvetica9&gt; &lt;bold&gt; "Invoice N° " (inv.NumInvoice) "\n"
  }
END BLOCK</pre><p><span class="strong"><strong>Example</strong></span>
Using Body section:</p><pre class="programlisting">REC TEXT Details
  POS 60 190
  SIZE 200 100

  line(String title, Object description)
  {
    &lt;details&gt;&lt;helvetica7&gt;&lt;!bold&gt; (title) ":"
    &lt;TAB TAB1&gt;&lt;helvetica8&gt;&lt;!bold&gt; (description)
  }

  boldline(String title, Object description)
  {
    &lt;details&gt;&lt;helvetica7&gt;&lt;bold&gt; (title) ":"
    &lt;TAB TAB1&gt;&lt;helvetica8&gt;&lt;bold&gt; (description)
  }

  newLine
  {
    &lt;helvetica4&gt; "\n"
  }

  BODY
  {
    Remise
    protected void print() throws Exception
      {
        line("Page", ""+getCurrentPage());
        boldline("Date", inv.DateInvoice);
        boldline("Client", inv.Customer );
        line("Adress", inv.Adress);
        line("Payment Mode", inv.PaymentMode);
        line("Delivery Mode", inv.DeliveryMode);
      }
  }
END BLOCK</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>List Blocks Definition</strong></span>
</li></ul></div><p>List blocks are used to insert tables of based on TABSET styles in the page:</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">ListBlockDefinition  : "LIST" [SimpleName]
                       [BlockPosition]
                       "STYLE" SimpleName
                       (PrintTriggers)*
                       [BlockBody]
                       "END" "BLOCK"</pre><p>The STYLE section only accepts block styles.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">  //STYLES DEFINITIONS


  PARAGRAPH STYLE posTabs
    ALIGN LEFT
    INDENT LEFT 5
    TABSET
      Article AT 10 ALIGN LEFT
      Quantity AT 140 ALIGN RIGHT
      Price AT 260 ALIGN RIGHT
      Discount AT 360 ALIGN RIGHT
      Total AT 490 ALIGN RIGHT
    BORDER 3 TOP
  END STYLE


  PARAGRAPH STYLE posTabsHead IS posTabs
    BORDER 5
    BACKGROUND 200 190 210
  END STYLE

 //INSERTING DATA

  LIST Loop1
  SIZE 500 480

  LISTHEADER
  {
    &lt;posTabsHead&gt; &lt;helvetica9&gt;&lt;bold&gt;
    &lt;TAB Article&gt; ("Article")
    &lt;TAB Quantity&gt; ("Quantity")
    &lt;TAB Price&gt; ("Price")
    &lt;TAB Discount&gt; ("Discount")
    &lt;TAB Total&gt; ("Total")
   }
  line(InvoicePos invpos)
  {
    &lt;posTabs&gt;
    &lt;helvetica4&gt; "\n" &lt;helvetica9&gt;
    &lt;TAB Article&gt; (invpos.Article)
    &lt;TAB Quantity&gt; (invpos.Quantity)
    &lt;bold&gt;
    &lt;TAB Price&gt; (invpos.Price)
    &lt;TAB Discount&gt; (invpos.Discount) " %"
    &lt;TAB Total&gt; (invpos.Quantity * (invpos.Price -
    ((invpos.Price * invpos.Discount)/100)))
    &lt;helvetica4&gt; "\n"
  }
  BODY
  {
    protected void print() throws Exception
      {
        invpos.setDefaultConnection(getDBContext().getConnection());
        invpos.open(id);
        while (invpos.next())
        {
          line(invpos);
          addBreak();
        }
        invpos.close();
    }
  }
  END BLOCK</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Recursive Blocks Definition</strong></span>
</li></ul></div><p>Also called vertical blocks, they are used to contain multiple blocks and displaying them vertically, you can use one of the block styles that you have defined in this block definition after the keyword STYLE, but no text styles and paragraph styles are allowed.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">RecursiveBlockDefinition : "VERTICAL" "BLOCK" [SimpleName]
                           [BlockPosition]
                           ["STYLE" SimpleName]
                           (PageBlocks).
                           "END" "BLOCK"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">VERTICAL BLOCK Loop
  POS 60 280
  SIZE 150 400
  STYLE darkGreyBlock

  LIST Loop1
  SIZE 500 480

  LISTHEADER
  {
    &lt;posTabsHead&gt; &lt;helvetica9&gt;&lt;bold&gt;
    &lt;TAB Article&gt; ("Article")
    &lt;TAB Quantity&gt; ("Quantity")
    &lt;TAB Price&gt; ("Price")
    &lt;TAB Discount&gt; ("Discount")
    &lt;TAB Total&gt; ("Total")
   }
  line(InvoicePos invpos)
  {
    &lt;posTabs&gt;
    &lt;helvetica4&gt; "\n" &lt;helvetica9&gt;
    &lt;TAB Article&gt; (invpos.Article)
    &lt;TAB Quantity&gt; (invpos.Quantity)
    &lt;bold&gt;
    &lt;TAB Price&gt; (invpos.Price)
    &lt;TAB Discount&gt; (invpos.Discount) " %"
    &lt;TAB Total&gt; (invpos.Quantity * (invpos.Price -
    ((invpos.Price * invpos.Discount)/100)))
    &lt;helvetica4&gt; "\n"
  }
  BODY
  {
    protected void print() throws Exception
      {
        invpos.setDefaultConnection(getDBContext().getConnection());
        invpos.open(id);
        while (invpos.next())
        {
          line(invpos);
          addBreak();
        }
        invpos.close();
    }
  }
  END BLOCK
END BLOCK</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Horizontal Blocks Definition</strong></span>
</li></ul></div><p>Horizontal Blocks are the same as vertical blocks (recursive blocks), they do contain other blocks but they display them horizontally, you can use one of the block styles that you have defined in this block definition after the keyword STYLE, but no text styles and paragraph styles are allowed.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">RecursiveBlockDefinition : "HORIZONTAL" "BLOCK" [SimpleName]
                           [BlockPosition]
                           ["STYLE" SimpleName]
                           (PageBlocks).
                           "END" "BLOCK"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">HORIZONTAL BLOCK texts
  POS 60 280
  SIZE 150 400
  TEXT text1
  ...
  END BLOCK

  TEXT text2
  ...
  END BLOCK
END BLOCK</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Rectangle Blocks Definition</strong></span>
</li></ul></div><p>This Type of blocks just insert a rectangle with the parameters of position, size and block style to set.</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">RectangleBlockDefinition : "RECT" SimpleName
                           [BlockPosition]
                           "STYLE" SimpleName
                           "END" "BLOCK"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">RECT Rectangle
  POS     50 120
  SIZE    100 150
  STYLE   greyBlock
END BLOCK</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Imported Blocks Definition</strong></span>
</li></ul></div><p>You can import already defined blocks using the INSERT keyword</p><p><span class="strong"><strong>Syntax</strong></span></p><pre class="programlisting">ImportedBlockDefinition : "INSERT" BlockType QualifiedName

BlockType               : "RECT" | "VERTICAL" "BLOCK"
                          | "HORIZONTAL" "BLOCK" | "TEXT"
                          | "LIST"</pre><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">INSERT TEXT OtherReport.BlockText</pre></div><div class="section" title="Page Header and Footer"><div class="titlepage"><div><div><h4 class="title"><a id="_page_header_and_footer"></a>Page Header and Footer</h4></div></div></div><p>After defining the page blocks , you can define the header and the footer,to do so you can just create a trigger named PAGEFOOTER or PAGEHEADER, or you can import a block as a header/footer.
<span class="strong"><strong>Examples</strong></span></p><pre class="programlisting">PAGEFOOTER {
  &lt;landscape&gt; &lt;helvetica8&gt; "Invoice N° " (numInvoice)
  "  -  Page " (getCurrentPage()) " / " (getPageCount()) "\n"
     &lt;helvetica8&gt; (Date.now()) " " (Time.now())
}


PAGEFOOTER AnotherPageFile.definedBlock</pre></div><div class="section" title="Page Context Footer"><div class="titlepage"><div><div><h4 class="title"><a id="_page_context_footer"></a>Page Context Footer</h4></div></div></div><p>In this section is inserted between curly brackets after you will have to define the page’s constructor and initializers, the data members and the types definitions and other methods.</p><p>Here is an example named InvoicePage, notice the use of cursor for types definitions, the initPage() method sets the connection to the database.
This static report prints a page of an invoice by its id:
<span class="strong"><strong>Example</strong></span></p><pre class="programlisting">//TYPES DEFINITION
#cursor Invoice (int id)
{
  SELECT int NumInvoice,
         String Customer,
         String Adress,
         String PaymentMode,
         String DeliveryMode,
         date DateInvoice,
         fixed Amount
  FROM   Invoices I
  WHERE  I.ID = :(id)
}

#cursor InvoicePos (int id)
{
  SELECT String Article,
         int Quantity,
         fixed Price,
         nullable int Discount
  FROM   InvoicesPos IP
  WHERE  IP.Invoice = :(id)
}

//INITIALIZERS

public InvoicePage(DBContextHandler handler, int id)
{
  super(handler);
  this.id = id;
}
public void initPage() throws SQLException
{
  inv.setDefaultConnection(getDBContext().getConnection());
  inv.open(id);
  inv.next();

}
public void closePage() throws SQLException
{
inv.close();
}

// DATA MEMBERS

private int id;
private Invoice inv = new Invoice();
private InvoicePos invpos = new InvoicePos();</pre></div></div><div class="section" title="2.4.2. Calling Print Pages"><div class="titlepage"><div><div><h3 class="title"><a id="_calling_print_pages"></a>2.4.2. Calling Print Pages</h3></div></div></div><p>Print pages are only available when called from a form that extends the VPrintSelectionForm class, besides, this class have to to implement
the abstract method createReport and the command print.</p><p><span class="strong"><strong>Example</strong></span></p><pre class="programlisting">FORM IS VPrintSelectionForm
...

{
  public PProtectedPage createReport(DBContextHandler handler){
  return new InvoicePage (handler , @!I.ID);
  }
}
END FORM</pre></div></div></div><div class="chapter" title="Chapter 3. The Kopi Project Future"><div class="titlepage"><div><div><h2 class="title"><a id="_the_kopi_project_future"></a>Chapter 3. The Kopi Project Future</h2></div></div></div><p>After reading this document, you should be able to create efficient database applications using the Kopi framework, you can also create dynamic reports and print pages, the all using java embedded SQL with kopi java extended language.
Actually, the project owners are working on a web version of the kopi framework called "KOPI WEB", this version features the same capabilities of the SWING based version and is based on the Vaadin framework which is an open source web application framework for rich Internet applications
Vaadin, uses java as programming language to create web content and Google web toolkit to render the resulting web page.</p></div></div></body></html>
